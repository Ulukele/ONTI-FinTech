Материалы для заключительного этапа профиля ФТ ОНТИ 2018/19 
====

# Финальная задача

## Набор заданий

Решение командной задачи разбито на подзадачи, сгруппированные в 3 набора.

Каждая подзадача (_user story_) формулирует необходимый функционал, который должен был быть реализован командой, а также набор приемочных тестов (_acceptance criteria_), позволявших проверить в полном ли объеме решена данная подзадача.

Каждый набор подзадач необходимо решать в отдельном этапе (итерации). Первые два этапа итеративно подводят участников к решению полной финальной задачи, осуществляемому во время последнего третьего этапа. На каждом этапе решение подзадач будет проверяться с помощью системы автоматической проверки решения, которое запускает решение участников с теми или иными параметрами в соответствии с приемочными тестами.

### Первая итерация

  * US-001 Регистрация контракта
  * US-004 Простое добавление пользователя в сервис индентификации
  * US-013 Получение баланса идентифицированного пользователя

### Вторая итерация

  * US-002 Вывод владельца контракта регистра соответствий
  * US-003 Изменение владельца контракта регистра соответствий
  * US-006 Получение всех пользователей из сервиса идентификации
  * US-007 Удаление пользователя из сервиса идентификации
  * US-008 Запуск обучения сервиса индентификации (кроме AC-008-04)
  * US-010 Идентификация пользователя
  * US-014 Отправка запроса на регистрацию соответствия
  * US-015 Отправка запроса на удаление соответствия
  * US-016 Отмена запроса на регистрацию или удаление соответствия
  * US-017 Отправка средств
  * US-021 Получение истории платежей
  * US-023 Получение всех запросов на регистрацию соответствий
  * US-024 Получение всех запросов на удаление соответствий
  * US-025 Подтверждение запросов на регистрацию или удаление соответствий
  * US-026 Получение аккаунта по номеру телефона

### Третья итерация

  * US-005 Улучшенное добавление пользователя в сервис индентификации
  * US-008 Запуск обучения сервиса индентификации (полностью)
  * US-009 Обнаружение уже добавленного пользователя
  * US-011 Запрос действий на безопасную идентификацию пользователя
  * US-012 Безопасная идентификация пользователя
  * US-018 Генерация сертификата на получение средств
  * US-019 Использование сертификата на получение средств
  * US-020 Вернуть средства из неиспользованных сертификатов
  * US-022 Получение истории платежей, включая использование сертификатов

## Условия проведения

В первые день соревнований все члены команд получают ноутбук со следующим набором установленного программного обеспечения:
  * набор Python инструментария Anaconda c установленными библиотеками `web3` (5.0.0a3), `cognitive_face`, `opencv-python`;
  * среды разработки PyCharm и WingIDE;
  * компилятор языка Solidity `solc` (0.5.4);
  * клиент системы ведения версий `git`;
  * Интернет-браузер Chrome.

Каждый ноутбук имеет возможность выхода в сеть Интернет. Команды могут использовать собственные ноутбуки.

Команды могут устанавливать дополнительное программное обеспечение, но после согласование с членами жюри.

Участники во время командного этапа финального тура могут использовать интернет и заранее подготовленные библиотеки для решения задачи.

Участники должны использовать язык программирования Python для написания программ, использующих командную строку. Для написания Ethereum контрактов участники могут использовать любой язык программирования.

Для работы с сервисом _Microsoft Face API_ участникам предоставляется один ключ подписки на команду, а также базовый URL для доступа к REST API. При доступе к сервису с помощью данного ключа действует ограничение на 10 запросов в секунду. Участники одной команды должны сами заботиться о том, чтобы держать ключ в тайне от других команд. Ключ не должен передаваться третьим лицам. Если ресурс ключа подписки (примерно 60000 запросов) полностью используется командой, то организаторы вправе не предоставлять команде другой ключ. 

Участники не могут использовать помощь тренера, сопровождающего лица или привлекать третьих лиц для решения задачи.

Финальная задача формулируется участникам в первый день финального тура, но участники выполняют решение задачи поэтапно. Критерии прохождения каждого этапа формулируются для каждого дня финального тура. За подзадачи, решенные в конкретном этапе начисляются, баллы. Баллы за подзадачи можно получить только в день, закрепленный за конкретным этапом.

В начале первого дня состязаний участники каждой команды получают доступ к репозиторию на серверах GitLab.com. Каждая команда имеет свой собственный репозиторий. Члены других команд не имеют доступ к чужим репозиториям.

В течение дня не ведется учет количества изменений, которые команды регистрируют в Git-репозитории.

В конце каждого дня финального этапа жюри проверяет решение участников на соответствие приемочным тестам для каждой подзадачи, входящей в набор для соответствующей итерации.

Баллы за все подзадачи, для которых прошло приемочное тестирование, определяют баллы, набранные командой в данный день соревнований.

Система автоматического тестирования имеет следующую конфигурацию:
  * OS Linux
  * Python 3.6
  * Python модули (перечислены) и соответствующие зависимости (не перечислены): `web3` (5.0.0a3), `opencv-python`, `cognitive_face`, `dlib`,  `imutils`, `ethereum`
  * `/usr/local/bin/solc` (5.5)
  * `/opt/shape_predictor_68_face_landmarks.dat`

После выставления баллов, командам предоставляется доступ к системе автоматического тестирования, ответственной за проведение приемочных тестов в конкретный день состязаний, так что члены команды могут ознакомиться с логикой проверки и подать апелляцию, если не согласны с корректностью проведения тестов.

После рассмотрения сути апелляции, жюри вправе провести тестирование вручную и назначить команде баллы за соответствующие подзадачи.

В начале следующего дня состязаний жюри выдает всем командам свое решение подзадач предыдущего дня, которое команды могут использовать для того, чтобы решать следующий набор подзадач.

## Процедура проведения приемочного тестирования и критерии оценки

Для каждого дня соревнований (для каждой итерации) справедлива следующая процедура приемочного тестирования:
  * В конце каждого дня финального этапа команды должны сформировать запрос на слияние (Merge Request) из своей ветки исходного кода в основную ветку (`master`) в Git-репозитории.
  * Команда ответственна за то, чтобы в запросе на слияние не должно быть конфликтов. Запрос на слияние с конфликтами может не рассматриваться жюри для выполнения приемочного тестирования.
  * После того, как все команды отправили запросы на слияние, жюри одобряет все запросы и приступает к приемочному тестированию, для тех подзадач, которые входят в соответствующую итерацию. Для этого исходный код приложения команды копируется на сервер жюри, и прогоняются автоматические тесты на соответствие решения участников требованиям к приемочным тестам (acceptance criteria).
  * Если все приемочные тесты для данной подзадачи пройдены успешно, команда получает баллы за данную подзадачу. Если хотя бы один тест не проходит, то баллы за данное подзадачу не начисляются.

Приемочные тесты для каждой подзадачи описаны в разделе "Подробное описание подзадач". 

Дальше перечислены баллы, которые получает команда за решение подзадач в каждой итерации.

Максимальное количество баллов, которое могла набрать команда за решение всех подзадач — 400.

### Первая итерация

| Подзадача | Баллы |
| :---- | :----: |
| US-001 Регистрация контракта | 10 |
| US-004 Простое добавление пользователя в сервис индентификации | 20 |
| US-013 Получение баланса идентифицированного пользователя | 10 |

Максимальное количество баллов за итерацию - 40.

### Вторая итерация

| Подзадача | Баллы |
| :---- | :----: |
| US-002 Вывод владельца контракта регистра соответствий | 10 |
| US-003 Изменение владельца контракта регистра соответствий | 10 |
| US-006 Получение всех пользователей из сервиса идентификации | 10 |
| US-007 Удаление пользователя из сервиса идентификации | 10 |
| US-008 Запуск обучения сервиса индентификации (кроме AC-008-04) | 18 |
| US-010 Идентификация пользователя (кроме AC-010-04) | 23 |
| US-014 Отправка запроса на регистрацию соответствия | 10 |
| US-015 Отправка запроса на удаление соответствия | 10 |
| US-016 Отмена запроса на регистрацию или удаление соответствия | 15 |
| US-017 Отправка средств | 10 |
| US-021 Получение истории платежей | 20 |
| US-023 Получение всех запросов на регистрацию соответствий | 10 |
| US-024 Получение всех запросов на удаление соответствий | 10 |
| US-025 Подтверждение запросов на регистрацию или удаление соответствий | 15 |
| US-026 Получение аккаунта по номеру телефона | 10 |

Максимальное количество баллов за итерацию - 191.

### Третья итерация

| Подзадача | Баллы |
| :---- | :----: |
| US-005 Улучшенное добавление пользователя в сервис индентификации | 50 |
| US-008 Запуск обучения сервиса индентификации (полностью) | 2 |
| US-009 Обнаружение уже добавленного пользователя | 20 |
| US-010 Идентификация пользователя (полностью) | 2 |
| US-011 Запрос действий на безопасную идентификацию пользователя | 5 |
| US-012 Безопасная идентификация пользователя | 35 |
| US-018 Генерация сертификата на получение средств | 10 |
| US-019 Использование сертификата на получение средств | 15 |
| US-020 Вернуть средства из неиспользованных сертификатов | 20 |
| US-022 Получение истории платежей, включая использование сертификатов | 10 |

Максимальное количество баллов за итерацию - 170.

## Подробное описание подзадач

Решение представляет из себя набор python скриптов (компонент), каждый из который ответственен за определенный функционал. 

Управление скриптами происходит через параметры командной строки и через конфигурационные файлы. Параметры командной строки описываются отдельно в разделах, где описывается функциональность каждого скрипта. Конфигурационные файлы - файлы в формате JSON, должны читаться из текущей директории, где происходит вызов скрипта и могут быть двух типов
  * конфигурационный файл с настройками для работы с _Microsoft Face API_
  * конфигурационный файл с настройками для работы с Ethereum узлом

**Конфигурационный файл с настройками для MS Face API**

Имя: `faceapi.json`

Содержит следующую информацию:
  * `key` - ключ подписки для использования сервиса;
  * `serviceUrl` - URL для доступа к сервису;
  * `groupId` - группа пользователей (в терминах _MS Face API_), с которой работает в данный момент скрипт.

Пример файла:
```json
{"key": "563879b61984550e40cbbe8d3039523c",
 "serviceUrl": "https://westeurope.api.cognitive.microsoft.com/face/v1.0/",
 "groupId": "fintech-01"}
```

**Конфигурационный файл с настройками для узла Ethereum**

Имя: `network.json`

Содержит следующую информация:
  * `rpcUrl` - URL для доступа к узлу по JSON RPC;
  * `privKey` - приватный ключ аккаунта для подписи транзакций, отправляемых на узел Ethereum, и для локальных вызовов;
  * `gasPriceUrl` - URL для доступа к сервису, предоставляющему цену за газ. Данный сервис возвращает JSON, из которого нужно взять значение (в _gwei_) из поля `fast`:
     ```json
     {"block_time":19.91,"fast":10.0,"instant":25.0,"block_number":7240426,"standard":5.0,"health":true,"slow":3.0}
     ```
  * `defaultGasPrice` - цена за газ в wei, использующаяся, если нельзя получить цену за газ из сервиса .

Пример файла:
```json
{"rpcUrl": "https://sokol.poa.network", 
 "privKey": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470", 
 "gasPriceUrl": "https://gasprice.poa.network/", 
 "defaultGasPrice": 2000000000}
```

Если это явно не прописано в описании функционала соответствующей компоненты, она не должна оставлять после себя никаких файлов-данных. Аналогично с получением данных - чтение данных из файла должно происходить только в нескольких случаях
  - для получения настроек для работы с MS Face API,
  - для получения видеопотока, эмулирующего камеру.
  - для получения настроек для работы с Ethereum узлом,
  - для получения Application Binary Interface контракта или его байткода, 
  - или если это явно указано в описании компоненты,
в остальных случаях данные должны быть получены из сервиса MS Face API или блокчейн сети. 

Все компоненты, работающие с сервисом _MS Face API_, должны уметь обрабатывать ситуации, когда:
  - недоступно подключение к сервису (сообщение об ошибке "No connection to MS Face API provider");
  - используется некорректный ключ подписки (сообщение об ошибке "Incorrect subscription key").

Компоненты, отправляющие транзакции в блокчейн, должны уметь обрабатывать ситуации, когда:
  - недоступно подключение к узлу Ethereum (сообщение об ошибке "No connection to node");
  - на счету аккаунта, от чьего имени выполняется транзакция, недостаточно средств, чтобы покрыть все затраты по использованному газу (сообщение об ошибке "No enough funds to send transaction");
  - транзакция может не включаться в блок продолжительное время в зависимости от нагрузки на сеть (сообщение об ошибке "Transaction is not validated too long").

При возникновении данных событий в терминал должно выдаваться сообщение понятное пользователю, а не stack trace.

Возможны также другие конфигурационные файлы, необходимые для работы тех или иных подсистем решения. Данные файлы будут отдельно описываться в соответствующих разделах. 

## Описание компонент

### Настройка сервиса KYC

Развертывание и настройка в блокечейн сети регистра соответствий аккаунтов и телефонных номеров (Know Your Customer, KYC) выполняется компанией производителем программного обеспечения (тем, кто разрабатывает данный сервис). Тоже самое относится к обработчику сертификатов на получение средств. Предполагается, что в потенциальные пользователи сервиса (пользователи, регистрирующие соответствия, владельцы платежных терминалов) могут ознакомиться с опубликованным в открытом доступе исходным кодом контрактов, принять решение на основе этого, доверять ли этому разработчику и начать пользоваться сервисом.

Фиксация контрактов в блокчейн гарантирует, что приозводитель не сможет изменить логику работы приложения позднее, т.е. условия участия в системе, с которыми ознакомились пользователи, не поменяется.

Функционал сервиса KYC должен быть доступен сразу, минуя фазы настройки, когда контракт зарегистрирован в блокчейн, но еще находится в нерабочем состоянии. Поэтому первичная настройка базовых параметров по максимуму должна выполняться вовремя инициализации контракта во время его регистрации (deploy).

**Синтаксис**
```shell
setup.py <command> [options]
```

#### US-001 Регистрация контракта

##### Использование скрипта
```shell
$ setup.py --deploy
```

Подключается к узлу Ethereum и регистрирует следующие контракты
* регистр соответствий аккаунтов и телефонных номеров в сети блокчейн. 
* обработчик сертификатов на получение средств.

На терминал выводятся адреса зарегистрованных контрактов. В текущей рабочей директории создается JSON файл `registrar.json`, содержащий адреса зарегистрированных контрактов.

##### Критерий оценивания AC-001-01
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ setup.py --deploy
KYC Registrar: 0x00360d2b7D240Ec0643B6D819ba81A09e40E5bCd
Payment Handler: 0x95426f2bC716022fCF1dEf006dbC4bB81f5B5164
$ cat registrar.json
{"registrar": {"address": "0x00360d2b7D240Ec0643B6D819ba81A09e40E5bCd", "startBlock": 123456}, "payments": {"address": "0x95426f2bC716022fCF1dEhttps://gasprice.poa.network/f006dbC4bB81f5B5164", "startBlock": 123457}}
```
_Комментарий_:

В блокчейн сеть отправляются транзакции для регистрации и первичной настройке контрактов. Транзакции успешно включены в один
или несколько блоков. Для проведения транзакции выбрана цена из значения `fast`, возвращенного сервисом `https://gasprice.poa.network`. Контракты по адресу, выведенным в терминале, созданы одной из отправленных транзакций, и могут быть просмотрены с помощью браузера блоков. 

##### Критерий оценивания AC-001-02
```shell
$ cat registrar.json
{"registrar": {"address": "0x00360d2b7D240Ec0643B6D819ba81A09e40E5bCd", "startBlock": 123456}, "payments": {"address": "0x95426f2bC716022fCF1dEf006dbC4bB81f5B5164", "startBlock": 123457}}
$ setup.py --deploy
KYC Registrar: 0x23B40E5bCd06D819ba81A09e0340Ec06460d2b7D
Payment Handler: 0xE797A1da01eb0F951E0E400f9343De9d17A06bac
$ cat registrar.json
{"registrar": {"address": "0x23B40E5bCd06D819ba81A09e0340Ec06460d2b7D", "startBlock": 456123}, "payments": {"address": "0xE797A1da01eb0F951E0E400f9343De9d17A06bac", "startBlock": 456125}}
```
_Комментарий_: 

Контракты по адресам, выведенным в терминале, созданы одной из отправленных транзакций, и могут быть просмотрены с помощью браузера блоков. 

##### Критерий оценивания AC-001-03
```shell
$ cat network.json | python -mjson.tool | grep gasPriceUrl 
    "gasPriceUrl": "https://gasprice.poa.network/",
$ curl https://gasprice.poa.network/
curl: (6) Could not resolve host: gasprice.poa.network
$ setup.py --deploy
KYC Registrar: 0x9FdddF5bf10c65221da0a78ADAFec1D8E9EF0A7D
Payment Handler: 0xD79A8FDB771Ea12359270aD7020bcCB328C9f5f7
```
_Комментарий_:

В блокчейн сеть отправляются транзакции для регистрации и первичной настройке контрактов. Транзакции успешно включены в один
или несколько блоков. Для проведения транзакции выбрана цена из значения `defaultGasPrice` из файла `network.json`.

#### US-002 Вывод владельца контракта регистра соответствий

##### Использование скрипта
```shell
$ setup.py --owner registrar
```

Подключается к узлу Ethereum и получает адрес аккаунта, имеющего полномочия выполнять действия по подверждению запросов на регистрацию и удалению соответствий аккаунтов и телефонных номеров в сети блокчейн. 

На терминал выводится адрес аккаунта.

##### Критерий оценивания AC-002-01
```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
$ setup.py --deploy
KYC Registrar: 0x9FdddF5bf10c65221da0a78ADAFec1D8E9EF0A7D
Payment Handler: 0xD79A8FDB771Ea12359270aD7020bcCB328C9f5f7
$ setup.py --owner registrar
Admin account: 0x9cce34F7aB185c7ABA1b7C8140d620B4BDA941d6
```
_Комментарий_:

Транзакции в блокчейн сеть не отправляются. 

##### Критерий оценивания AC-002-02
```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "64e604787cbf194841e7b68d7cd28786f6c9a0a3ab9f8b0a0e87cb4387ab0107",
$ cat registrar.json
{"registrar": {"address": "0x9FdddF5bf10c65221da0a78ADAFec1D8E9EF0A7D", "startBlock": 234156}, "payments": {"address": "0xD79A8FDB771Ea12359270aD7020bcCB328C9f5f7", "startBlock": 451247}}
$ setup.py --owner registrar
Admin account: 0x9cce34F7aB185c7ABA1b7C8140d620B4BDA941d6
```
_Комментарий_:

Транзакции в блокчейн сеть не отправляются.

#### US-003 Изменение владельца контракта регистра соответствий

##### Использование скрипта
```shell
$ setup.py --chown registrar <address>
```

Подключается к узлу Ethereum и отправляет транзакцию на изменение аккаунта, имеющего полномочия выполнять действия по подверждению запросов на регистрацию и удалению соответствий аккаунтов и телефонных номеров в сети блокчейн. Только аккаунт, в текущее время обладающий полномочиями на выполнение вышеуказанных действий, имеет возможность производить данное изменение.

На терминал выводится адрес нового аккаунта.

##### Критерий оценивания AC-003-01
```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
$ setup.py --owner registrar
Admin account: 0x9cce34F7aB185c7ABA1b7C8140d620B4BDA941d6
$ setup.py --chown registrar 0x6455f1445c72ba9460c6f6ab364d3935a0ad4559
New admin account: 0x6455F1445c72BA9460C6f6AB364d3935a0AD4559
$ setup.py --owner registrar
Admin account: 0x6455F1445c72BA9460C6f6AB364d3935a0AD4559
```
_Комментарий_:

В блокчейн сеть отправляется транзакция для изменения аккаунта. Транзакция успешно верифицирована и включена в блок. Для проведения транзакции выбрана цена из значения `fast`, возвращенного сервисом `https://gasprice.poa.network`.

##### Критерий оценивания AC-003-02
```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
$ setup.py --owner registrar
Admin account: 0x6455F1445c72BA9460C6f6AB364d3935a0AD4559
$ setup.py --chown registrar 0x11460ff94ca4212d9d02b5bea1766dd099e0a9df
Request cannot be executed
$ setup.py --owner registrar
Admin account: 0x6455F1445c72BA9460C6f6AB364d3935a0AD4559
```
_Комментарий_:

Транзакции в блокчейн сеть не отправляются.

##### Критерий оценивания AC-003-03
```shell
$ cat network.json | python -mjson.tool | grep gasPriceUrl 
    "gasPriceUrl": "https://gasprice.poa.network/",
$ curl https://gasprice.poa.network/
curl: (6) Could not resolve host: gasprice.poa.network
$ setup.py --chown registrar 0x11460ff94ca4212d9d02b5bea1766dd099e0a9df
New admin account: 0x11460ff94cA4212d9D02b5bEA1766Dd099E0A9DF
```
_Комментарий_:

В блокчейн сеть отправляется транзакция для изменения аккаунта. Транзакция успешно верифицирована и включена в блок. Для проведения транзакции выбрана цена из значения `defaultGasPrice` из файла `network.json`.

##### Критерий оценивания AC-003-04
```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
$ setup.py --owner registrar
Admin account: 0x9cce34F7aB185c7ABA1b7C8140d620B4BDA941d6
$ setup.py --chown registrar 0x6455f1445c72ba9460c6f6ab364d3935a0ad4559
New admin account: 0x6455F1445c72BA9460C6f6AB364d3935a0AD4559
$ setup.py --owner registrar
Admin account: 0x6455F1445c72BA9460C6f6AB364d3935a0AD4559
```
_Комментарий_:

Если из транзакции, которая была отправлена в результате команды `setup.py --chown`, извлечь поле `input` и отправить его в новой транзакции снова в поле `input` на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка, поскольку новый аккаунт, обладающий полномочиями, был изменен транзакцией, посланной командо `setup.py --chown`. Следовательно, изменение аккаунта с полномочиями выполнять действия по подверждению запросов на регистрацию и удалению соответствий аккаунтов и телефонных номеров не происходит. Статус можно подтвердить для данной транзакции в браузере блоков.

### Подотовка сервиса идентификации

Сервис идентификации человека по лицу перед полноценной работой требует предварительной настройки. Первое, что должно быть сделано - в сервис необходимо добавить лица людей, которых в дальнейшем необходимо идентифицировать. Поскольку система автоматического тестирования не может работать с камерой, то изображения человека будут передаваться через видео-файл, передаваемый в сервис через параметры командной строки.

Администратор свервиса должен иметь возможность просматривать список добавленных пользователей, удалять пользователя (и его изображения) из системы. 

Как только необходимое количество лиц зарегистрировано в сервисе, администратор может запустить обучение нейронной сети.

**Синтаксис**
```shell
face-management.py <command> [options]
```

#### US-004 Простое добавление пользователя в сервис индентификации

Сервис должен быть устроен так, что добавление изображений человека в систему происходит анонимно, т.е. имя при добавлении не указывается. 

##### Использование скрипта
```shell
$ face-management.py --simple-add <path to video file>
```

При использовании команды простого добавления пользователя из видео-потока извлекается 5 кадров с изображением лица человека. При этом подразумевается, что все кадры в видео приндалежат одному и тому же человеку. 

Если в видео-потоке недостаточно кадров с изображением человека, то обработка такого видео должно приводить к ошибке. 

##### Критерий оценивания AC-004-01
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups/fintech-01" -H "Content-Type: application/json" -H "Ocp-Apim-Subscription-Key: 000000000000000000000000000000000" 
{"error":{"code":"PersonGroupNotFound","message":"Person group is not found.\r\nParameter name: personGroupId"}}
$ face-management.py --simple-add /path/to/video.avi
5 frames extracted
PersonId: 419e345a-e6d6-4d9c-953d-667787b8d52e
FaceIds
=======
e27558b9-812d-41c3-b114-8e434b8f4602
44c350f2-6653-4616-a1b7-e0fe9b481b6b
f945a3be-4b20-4049-b080-4142a55e4f93
855ab7c2-9bb3-49ed-8cac-1366c0274b08
9c4af288-54cd-4375-8eef-f8c29ed56685
```
_Комментарий_:

Требуемый `personGroupId` не существовал до этого в сервисе _Microsoft Face API_. После добавления `personGroupId` добавляется новый `personId`, с которым ассоциируется 5 изображений лица (`persistedFaceId`). 

##### Критерий оценивания AC-004-02
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups" -H "Content-Type: application/json" -H "OcApim-Subscription-Key: 000000000000000000000000000000000" 
[{"personGroupId":"fintech-01","name":"fintech-01","userData":null}]
$ face-management.py --simple-add /path/to/video1.avi
5 frames extracted
PersonId: 37da04e7-f471-49c7-a54c-a08f05950fc5
FaceIds
=======
1d499868-3d01-487c-8bab-626dc562e4e8
27dadf08-bc60-4a29-82a7-7d21ea7f40af
b8cf9c2f-a606-4f21-851d-26e0a0dc8a74
bf4806de-8c4b-4a12-8495-002f43dba797
ff79486f-15ac-43be-9c6c-b2840f8c8d22
```
_Комментарий_:

Требуемый `personGroupId` существует в _Microsoft Face API_. В данную группу добавляется новый `personId`, с которым ассоциируется 5 изображений лица (`persistedFaceId`). 

##### Критерий оценивания AC-004-03
```shell
face-management.py --simple-add /path/to/video2.avi
Video does not contain any face
```
_Комментарий_:

Выдается ошибка при попытке обработать видео, в котором либо нет кадров с лицом пользователя, либо в видео содержится меньше 5 кадров. Группа с `personGroupId` не создается, новый `personId` не добавляется.

##### Критерий оценивания AC-004-04
```shell
$ face-management.py --simple-add /path/to/video1.avi
5 frames extracted
PersonId: 52865cde-3af8-443d-b260-9319c2cb1788
FaceIds
=======
cdb6227e-7453-4057-b4fa-79660914e597
6976d3c2-dee5-4f24-8950-f38ff10c70ad
fae15e55-6639-42a4-a954-731c33310e41
15092567-5765-49ed-ac63-94bc5fa08d17
a77f1f0a-aa95-4bd1-9826-6b453aec42b2
$ face-management.py --simple-add /path/to/video31.avi
5 frames extracted
PersonId: 9fa0a99b-8e76-474d-8223-dea217c2c19b
FaceIds
=======
b552ef11-a162-4a7d-9047-ccfc84a07043
90c0815a-ecce-45c6-8107-ced7ef29a249
fde35dba-505d-4a62-ac5a-c6ae4c89128e
6c6910b4-0ab5-4eb4-9e53-95b1929f9867
fdb9d352-65b0-41a2-a1be-03ea5b543160
$ face-management.py --simple-add /path/to/video41.avi
5 frames extracted
PersonId: f290ecb9-bfab-46f7-b623-45140d730628
FaceIds
=======
e5735ecd-ca09-4fd4-bfd3-8ace67702ab0
9e1bbdee-5981-4f6b-aba5-03be57e5e910
3120ef58-8d53-4558-8b84-784ba338f621
8fceb9c7-f029-4326-9703-6749005674fa
8ea02a3b-7dc0-455a-858c-67251b0ca3b4
```
_Комментарий_:

Несколько добавлений пользователя проходят успешно. Для каждого видео добавляется новый `personId` добавляется.


#### US-005 Улучшенное добавление пользователя в сервис индентификации

Наличие в наборе изображений одного и того же человека, но у которых есть различия в мимике, положении головы и освещенности, влияет на качество обучения нейронной сети сервиса, поэтому при сборе данных для сервиса идентификации важно собирать разные изображения.

##### Использование скрипта
```shell
$ face-management.py --add <path to video file 1> [ <path to video file 2> [ <path to video file 3> [ <path to video file 4> [ <path to video file 5> ] ] ] ]
```

Команда ожидает 5 видео файлов. Требования к каждому из видео файлов:
  * В первом по списку видеофайле лицо человека должно быть неподвижно (допускаются небольшие повороты)
  * Во втором по списку видеофайле должны быть зафиксированы наклоны головы влево и вправо (_roll_)
  * В третьем по списку видеофайле должны быть зафиксированы повороты головы влево и вправо (_yaw_)
  * В четвертом видеофайле должен быть зафиксирован открытый рот
  * В пятом - должно быть зафиксировано закрытие глаз

#### US-006 Получение всех пользователей из сервиса идентификации

Администратор сервиса может получить список всех добавленных пользователей. 

##### Использование скрипта
```shell
$ face-management.py --list
```

##### Критерий оценивания AC-006-01
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups/fintech-01" -H "Content-Type: application/json" -H "Ocp-Apim-Subscription-Key: 000000000000000000000000000000000" 
{"error":{"code":"PersonGroupNotFound","message":"Person group is not found.\r\nParameter name: personGroupId"}}
$ face-management.py --list
The group does not exist
```
_Комментарий_:

Требуемый `personGroupId` не существовует в сервисе _Microsoft Face API_ ни до, ни после выполнения команды. 

##### Критерий оценивания AC-006-02
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups" -H "Content-Type: application/json" -H "OcApim-Subscription-Key: 000000000000000000000000000000000" 
[{"personGroupId":"fintech-01","name":"fintech-01","userData":null}]
$ face-management.py --list
Persons IDs:
27dadf08-bc60-4a29-82a7-7d21ea7f40af
b8cf9c2f-a606-4f21-851d-26e0a0dc8a74
bf4806de-8c4b-4a12-8495-002f43dba797
ff79486f-15ac-43be-9c6c-b2840f8c8d22
```
_Комментарий_:

Требуемый `personGroupId` существует в _Microsoft Face API_. 

##### Критерий оценивания AC-006-03
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups" -H "Content-Type: application/json" -H "OcApim-Subscription-Key: 000000000000000000000000000000000" 
[{"personGroupId":"fintech-01","name":"fintech-01","userData":null}]
$ face-management.py --list
No persons found
```
_Комментарий_:

Требуемый `personGroupId` существует в _Microsoft Face API_, но в ней нет пользователей.

#### US-007 Удаление пользователя из сервиса идентификации

Администратор сервиса может удалить пользователя сервиса по его идентификатору. 

##### Использование скрипта
```shell
$ face-management.py --del <person id>
```

##### Критерий оценивания AC-007-01
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups/fintech-01" -H "Content-Type: application/json" -H "Ocp-Apim-Subscription-Key: 000000000000000000000000000000000" 
{"error":{"code":"PersonGroupNotFound","message":"Person group is not found.\r\nParameter name: personGroupId"}}
$ face-management.py --del 27dadf08-bc60-4a29-82a7-7d21ea7f40af
The group does not exist
```
_Комментарий_:

Требуемый `personGroupId` не существовует в сервисе _Microsoft Face API_ ни до, ни после выполнения команды. 

##### Критерий оценивания AC-007-02
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups" -H "Content-Type: application/json" -H "OcApim-Subscription-Key: 000000000000000000000000000000000" 
[{"personGroupId":"fintech-01","name":"fintech-01","userData":null}]
$ face-management.py --del 27dadf08-bc60-4a29-82a7-7d21ea7f40af
Person deleted
```
_Комментарий_:

Требуемый `personGroupId` существует в _Microsoft Face API_. Пользователь с заданным ID удаляется из сервиса. 

##### Критерий оценивания AC-007-03
```shell
$ face-management.py --del bdaf190a-4805-4e2c-95af-1afa8b2623df
The person does not exist
```
_Комментарий_:

Пользователь с данным ID не существет в требуемой `personGroupId`.

#### US-008 Запуск обучения сервиса индентификации 

Администратор сервиса может запустить обучение нейронной сети сервиса _Microsoft Face API_ для возможности дальнейшего распознавания человека по лицу.

Обучение должно запускаться только если до этого происходило добавление или удаление нового человека.

##### Использование скрипта
```shell
$ face-management.py --train
```

##### Критерий оценивания AC-008-01
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups/fintech-01" -H "Content-Type: application/json" -H "Ocp-Apim-Subscription-Key: 000000000000000000000000000000000" 
{"error":{"code":"PersonGroupNotFound","message":"Person group is not found.\r\nParameter name: personGroupId"}}
$ face-management.py --train
There is nothing to train
```
_Комментарий_:

Требуемый `personGroupId` не существовует в сервисе _Microsoft Face API_ ни до, ни после выполнения команды. Тренировка сервиса не запускается.

##### Критерий оценивания AC-008-02
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups" -H "Content-Type: application/json" -H "OcApim-Subscription-Key: 000000000000000000000000000000000" 
[{"personGroupId":"fintech-01","name":"fintech-01","userData":null}]
$ face-management.py --train
There is nothing to train
```
_Комментарий_:

Требуемый `personGroupId` существует в _Microsoft Face API_, но в группе нет ни одного добавленного пользователя. Тренировка сервиса не запускается. 

##### Критерий оценивания AC-008-03
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups" -H "Content-Type: application/json" -H "OcApim-Subscription-Key: 000000000000000000000000000000000" 
[{"personGroupId":"fintech-01","name":"fintech-01","userData":null}]
$ face-management.py --simple-add /path/to/video1.avi
5 frames extracted
PersonId: 37da04e7-f471-49c7-a54c-a08f05950fc5
FaceIds
=======
1d499868-3d01-487c-8bab-626dc562e4e8
27dadf08-bc60-4a29-82a7-7d21ea7f40af
b8cf9c2f-a606-4f21-851d-26e0a0dc8a74
bf4806de-8c4b-4a12-8495-002f43dba797
ff79486f-15ac-43be-9c6c-b2840f8c8d22
$ face-management.py --train
Training successfully started
```
_Комментарий_:

Требуемый `personGroupId` существует в _Microsoft Face API_. Поскольку запуску команды тренировки сервиса предшествует команда добавления пользователя, то обучение запускается. 

##### Критерий оценивания AC-008-04
```shell
$ face-management.py --add /path/to/video1.avi /path/to/video2.avi /path/to/video3.avi /path/to/video4.avi /path/to/video6.avi
18 frames extracted
PersonId: 5d5d6e92-f8f0-47cf-8e9b-b4455092603e
FaceIds
=======
0e5edd8e-7756-470e-a26c-f54ab70a5524
73b4caea-c85c-4594-9153-198351937d94
2ae3c850-190a-4cd0-afd2-8efa341767ba
adb7744e-b2fb-4a58-b3a8-f22c3143a8cd
7e0f87d6-14ad-4ec6-971f-e4c2771cc267
47c8c307-1f90-473c-b48c-792d5b5a1241
33e35a22-358a-4847-bcdd-4a5bdfd5eb69
2c7b951b-126a-4eec-9e22-1d9d65ece9e3
bcaf7f6a-1c44-476e-a51f-9dde2744ade0
1c9c0134-ada0-47c2-848c-d4424b232f04
b79945e1-de47-4011-98f2-e7e8f0d9f3ef
f972b6ac-078b-4e3d-a779-4cde8ea28f36
fbeb7aa1-f66e-4412-ad07-b61103e8af0b
9c762e64-075b-4fa4-8e39-0d83df86428b
9794e349-e4e4-44ad-951c-610b4890b16e
2e93da04-8f31-4a27-bd9e-5768335447a5
b9227512-dfa8-4a17-94e2-be520b8975a9
b67c1f86-2e3d-45a2-a7fb-57bbbff9cd8c
$ face-management.py --train
Training successfully started
```
_Комментарий_:

Поскольку запуску команды тренировки сервиса предшествует команда добавления пользователя, то обучение запускается. 

##### Критерий оценивания AC-008-05
```shell
$ face-management.py --del 27dadf08-bc60-4a29-82a7-7d21ea7f40af
Person deleted
$ face-management.py --train
Training successfully started
```
_Комментарий_:

Поскольку запуску команды тренировки сервиса предшествует команда удаления пользователя, то обучение запускается. 

##### Критерий оценивания AC-008-06
```shell
$ face-management.py --train
Training successfully started
$ face-management.py --del bdaf190a-4805-4e2c-95af-1afa8b2623df
The person does not exist
$ face-management.py --train
Already trained
```
_Комментарий_:

Поскольку после предыдущего запуска команды тренировки сервиса изменений в списке пользователей не происходило, то обучение не запускается. 

#### US-009 Обнаружение уже добавленного пользователя 

Администратор сервиса не сможет добавить пользователя в сервис _Microsoft Face API_, если изображения лица данного пользователя уже были добавлены в систему, и эти изображения были использованы для обучения сервиса.

### Взаимодействие с пользователем

#### US-010 Идентификация пользователя

Для идентификации пользователя, компонента использует кадры с лицом из видео-потока и отправляет их в сервис _Microsoft Face API_. 

##### Использование скрипта
```shell
$ faceid.py --find <path to video file>
```

В случае, когда в текущей директории нет файла `actions.json`, то запускается простой (небезопасный) способ аутентификации. При этом из видео-потока извлекается 5 кадров с изображением лица человека. Подразумевается, что все кадры в видео приндалежат одному и тому же человеку. Идентификация человека происходит успешно, если кадры из видео указывают на одного и того же человека с высокой степенью (не менее 50%) уверенности определения.

Если в видео-потоке недостаточно кадров с изображением человека или на изображении невозможно определить лицо, то обработка такого видео должно приводить к ошибке. 

После успешной идентификации в текущей директории создается (если файл уже существовал, то он пересоздается) файл `person.json`, в котором указывается идентификатор, возвращенный сервисом _Microsoft Face API_. Пример файла:
```json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
```

##### Критерий оценивания AC-010-01
```shell
$ face-management.py --simple-add /path/to/video1.avi
5 frames extracted
PersonId: 37da04e7-f471-49c7-a54c-a08f05950fc5
FaceIds
=======
1d499868-3d01-487c-8bab-626dc562e4e8
27dadf08-bc60-4a29-82a7-7d21ea7f40af
b8cf9c2f-a606-4f21-851d-26e0a0dc8a74
bf4806de-8c4b-4a12-8495-002f43dba797
ff79486f-15ac-43be-9c6c-b2840f8c8d22
$ face-management.py --train
Training successfully started
$ cat person.json
cat: person.json: No such file or directory
$ faceid.py --find /path/to/video21.avi
37da04e7-f471-49c7-a54c-a08f05950fc5 identified
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
```
_Комментарий_:

Первое и второе видео содержат кадры лица одного и того же человека. Идентификация человека на втором видео происходит успешно, поскольку пять разных кадров из видео указывают на одного и того же человека с высокой степенью (не менее 50%) уверенности определения. В текущей директории создан файл `person.json`

##### Критерий оценивания AC-010-02
```shell
$ face-management.py --simple-add /path/to/video1.avi
5 frames extracted
PersonId: 37da04e7-f471-49c7-a54c-a08f05950fc5
FaceIds
=======
1d499868-3d01-487c-8bab-626dc562e4e8
27dadf08-bc60-4a29-82a7-7d21ea7f40af
b8cf9c2f-a606-4f21-851d-26e0a0dc8a74
bf4806de-8c4b-4a12-8495-002f43dba797
ff79486f-15ac-43be-9c6c-b2840f8c8d22
$ face-management.py --train
Training successfully started
$ face-management.py --simple-add /path/to/video2.avi
5 frames extracted
PersonId: d9e01953-7bc1-4079-96af-3f3a26cf4b1d
FaceIds
=======
3c8195bb-49e7-4b45-b7ae-d44e60310599
d01523ce-cd83-4605-8298-afd4bb8d9e81
c0facdb1-704f-44f2-b76f-4e7298c476be
dcfa8e7b-f8d4-4567-80c5-55f3c5e13d85
a6872fc7-e45b-467f-b9a7-e18935d057da
$ cat person.json
{"id": "33fc4c4a-911a-4ab0-9535-f588d47c3a60"}
$ faceid.py --find /path/to/video21.avi
The service is not ready
$ cat person.json
cat: person.json: No such file or directory
```
_Комментарий_:

Первое и третье видео содержат кадры лица одного и того же человека. Но поскольку после добавления нового пользователя не происходило повторное обучение сервиса, идентификация человека невозможна. Существовавший в текущей директории файл `person.json` удаляется.

##### Критерий оценивания AC-010-03
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups/fintech-01" -H "Content-Type: application/json" -H "Ocp-Apim-Subscription-Key: 000000000000000000000000000000000" 
{"error":{"code":"PersonGroupNotFound","message":"Person group is not found.\r\nParameter name: personGroupId"}}
$ faceid.py --find /path/to/video21.avi
The service is not ready
$ cat person.json
cat: person.json: No such file or directory
```
_Комментарий_:

Поскольку не существует группы на момент запуска команды идентификации пользователя, то идентификация человека невозможна. Файл `person.json` не создается.

##### Критерий оценивания AC-010-04
```shell
$ face-management.py --add /path/to/video1.avi /path/to/video2.avi /path/to/video3.avi /path/to/video4.avi /path/to/video5.avi
18 frames extracted
PersonId: 5d5d6e92-f8f0-47cf-8e9b-b4455092603e
FaceIds
=======
0e5edd8e-7756-470e-a26c-f54ab70a5524
73b4caea-c85c-4594-9153-198351937d94
2ae3c850-190a-4cd0-afd2-8efa341767ba
adb7744e-b2fb-4a58-b3a8-f22c3143a8cd
7e0f87d6-14ad-4ec6-971f-e4c2771cc267
47c8c307-1f90-473c-b48c-792d5b5a1241
33e35a22-358a-4847-bcdd-4a5bdfd5eb69
2c7b951b-126a-4eec-9e22-1d9d65ece9e3
bcaf7f6a-1c44-476e-a51f-9dde2744ade0
1c9c0134-ada0-47c2-848c-d4424b232f04
b79945e1-de47-4011-98f2-e7e8f0d9f3ef
f972b6ac-078b-4e3d-a779-4cde8ea28f36
fbeb7aa1-f66e-4412-ad07-b61103e8af0b
9c762e64-075b-4fa4-8e39-0d83df86428b
9794e349-e4e4-44ad-951c-610b4890b16e
2e93da04-8f31-4a27-bd9e-5768335447a5
b9227512-dfa8-4a17-94e2-be520b8975a9
b67c1f86-2e3d-45a2-a7fb-57bbbff9cd8c
$ face-management.py --train
Training successfully started
$ faceid.py --find /path/to/video22.avi
The person was not found
$ cat person.json
cat: person.json: No such file or directory
```
_Комментарий_:

Видео, использовавшееся при добавлении человека, и видео, использующееся при распознавании, содержат кадры лица разных людей. Человек, чье лицо изображено на видео, использующееся при распозновании, не был добавлен до этого в сервис _Microsoft Face API_. Кадры лица человека из второго видео не добавляются в сервис _Microsoft Face API_. Файл `person.json` не создается.

##### Критерий оценивания AC-010-05
```shell
$ cat faceapi.json | python -mjson.tool | grep groupId
    "groupId": "fintech-01",
$ curl -X GET "https://westeurope.api.cognitive.microsoft.com/face/v1.0/persongroups/fintech-01" -H "Content-Type: application/json" -H "Ocp-Apim-Subscription-Key: 000000000000000000000000000000000" 
{"error":{"code":"PersonGroupNotFound","message":"Person group is not found.\r\nParameter name: personGroupId"}}
$ faceid.py --find /path/to/video100.avi
The video does not follow requirements
$ cat person.json
cat: person.json: No such file or directory
$ face-management.py --simple-add /path/to/video1.avi
5 frames extracted
PersonId: 37da04e7-f471-49c7-a54c-a08f05950fc5
FaceIds
=======
1d499868-3d01-487c-8bab-626dc562e4e8
27dadf08-bc60-4a29-82a7-7d21ea7f40af
b8cf9c2f-a606-4f21-851d-26e0a0dc8a74
bf4806de-8c4b-4a12-8495-002f43dba797
ff79486f-15ac-43be-9c6c-b2840f8c8d22
$ face-management.py --train
Training successfully started
$ faceid.py --find /path/to/video100.avi
The video does not follow requirements
$ cat person.json
cat: person.json: No such file or directory
```
_Комментарий_:

Видео, использующееся при распознавании, либо содержит меньше 5 кадров, либо не содержит кадров с лицом пользователя. Файл `person.json` не создается.

##### Критерий оценивания AC-010-06
```shell
$ faceid.py --find /path/to/video101.avi
The person was not found
$ cat person.json
cat: person.json: No such file or directory
```
_Комментарий_:

На видео, использующееся при распознавании, как минимум один из пяти разных кадров указывает на человека, отличающегося от человека в других кадрах. Степень уверенности определения не менее 50%. Файл `person.json` не создается.

#### US-011 Запроса действий на безопасную идентификацию пользователя

в JSON помещается набор действий, которые должен выполнить пользователь

##### Использование скрипта
```shell
$ faceid.py --actions
```

#### US-012 Безопасная идентификация пользователя

Должен быть action JSON, сохраняет PersonId в person JSON.

##### Использование скрипта
```shell
$ faceid.py --find <path to video file>
```

#### US-013 Получение баланса идентифицированного пользователя

После идентификации пользователь может получить баланс на соответствующем данному пользователю аккаунте в сети блокчейн.

##### Использование скрипта
```shell
$ faceid.py --balance <PIN code>
```

Используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя. В блокчейн сеть отправляется запрос на баланс аккаунта, полученного из приватного ключа.

Приватный ключ генерируется по правилу:

$$K = keccak256(keccak256(keccak256(keccak256(keccak256(''), I, P_1), I, P_2), I, P_3), I, P_4)$$

где $''$ - 'пустая' последовательность байт, $I$ - это идентификатор, который возвращает система распознавания по лицу, приведенный к длине в 16 байт, а ($P_1$, $P_2$, $P_3$, $P_4$) - четыре цифры PIN-кода, где каждая цифра представлена целым числом длиной 1 байт, $P_1$ - цифра самого старшего разряда в PIN-коде (первая цифра), а $P_4$ - цифра самого младшего разряда в PIN-коде (последняя цифра).

Например, идентификатору `37da04e7-f471-49c7-a54c-a08f05950fc5` при применении PIN-кода `1234` соответствует приватный ключ `6be7217f318a6409ba8e87e42ce600e14153647a816f7f2d43d244d1a00ed3df`.

При выводе баланса должно быть автомтическое масштабирование суммы - нормализация к одному из возможных значений: _poa_, _finney_, _szabo_, _gwei_, _mwei_, _kwei_, _wei_. Происходит следующим образом:
  * Используется минимально возможное нормализованное значение, чья целая часть больше ноля;
  * Дробная часть записывается с округлением до $10^{-6}$;
  * Завершающие нули в дробной части, полученные полсе округления, не записываются (например, 1.3, но не 1.300000).

##### Критерий оценивания AC-013-01
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --balance 4590
Your balance is 2.5 poa
```
_Комментарий_:

Баланс пользователя получен от узла блокчейн сети, доступ к которому получен через JSON RPC.

##### Критерий оценивания AC-013-02
```shell
$ cat person.json
{"id": "a9d0f1d5-1359-43ca-bcc3-cc7c1e314b86"}
$ faceid.py --balance 1864
Your balance is 84.000138 szabo
```
_Комментарий_:

Баланс пользователя получен от узла блокчейн сети, доступ к которому получен через JSON RPC.

##### Критерий оценивания AC-013-03
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --balance 6879
Your balance is 0 poa
```
_Комментарий_:

Неправильно задан PIN-код, поэтому баланс запрашивается у несуществующего аккаунта.

##### Критерий оценивания AC-013-04
```shell
$ cat person.json
cat: person.json: No such file or directory
$ faceid.py --balance 6879
ID is not found
```
_Комментарий_:

Выдается ошибка, если в текущей директории не существует файл `person.json`.

#### US-014 Отправка запроса на регистрацию соответствия

После идентификации пользователь может отправить запрос на регистрацию соответствия между телефоном и своим аккаунтом.

##### Использование скрипта
```shell
$ faceid.py --add <pin code> <phone number>
```

Используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя. В блокчейн сеть отправляется транзакция к контракту регистра соответствий с запросом регистрации. В терминал выводится хэш транзакции, в рамках которой в контракт добавлен запрос регистрации.  

##### Критерий оценивания AC-014-01
```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
```
_Комментарий_:

В блокчейн сеть отправляется транзакция с запросом регистрации соответствия аккаунта, ассоциированного с аккаунтом, указанным в файле `person.json` и номером телефона, указанным в параметре командной строки. При обработке запроса, контракт производить событие (`event`) `RegistrationRequest`, в с указанием аккаунта, отправившего запрос:

```solidity
event RegistrationRequest(address indexed sender);
```

Для проведения транзакции выбрана цена из значения `fast`, возвращенного сервисом `https://gasprice.poa.network`.

##### Критерий оценивания AC-014-02
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ faceid.py --add 4590 +79991234567
Registration request already sent
$ faceid.py --add 4590 +79991239812
Registration request already sent
```
_Комментарий_:

Повторный запрос на регистрацию соответствия аккаунта не отправляется в блокчейн сеть, поскольку данный аккаунт уже посылал запрос на регистрацию соответствий. Первичный запрос еще не был обработан. В терминал выводится сообщение об ошибке. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-014-03
```shell
$ cat person.json
cat: person.json: No such file or directory
$ faceid.py --add 4590 +79991234567
ID is not found
```
_Комментарий_:

Выдается ошибка, если в текущей директории не существует файл `person.json`. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-014-04
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 1234 +79991234567
No funds to send the request
```
_Комментарий_:

Поскольку ситуация, когда неправильный приватный ключ сформирован из-за некорретного PIN-кода, неотличима от ситуации, когда на аккаунте нет средств для оплаты комиссии на обработку транзакции, в терминал выводится сообщение об ошибке. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-014-05
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ faceid.py --add 4590 +79122229016
No contract address
```
_Комментарий_:

Выдается сообщение об ошибке, если в текущей директории нет файла `registrar.json`, содержащего адрес контракта регистра соответствий. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-014-06
```shell
$ cat registrar.json
{"registrar": {"address": "0x340Ec06460d9b2b7D23B40E5bCd0a81A09e06D81", "startBlock": 456123}, "payments": {"address": "0x81A09e06D81797AE2b7D23B40E5bCd0a1da01eb0F951x", "startBlock": 456125}}
$ faceid.py --add 4590 +79122229016
Seems that the contract address is not the registrar contract
```
_Комментарий_:

Выдается сообщение об ошибке, если в адрес контракта, указанного в файле `registrar.json`, не принадлежит контракту регистра соответствий.

##### Критерий оценивания AC-014-07
```shell
$ faceid.py --add 4590 +79122
Incorrect phone number
$ faceid.py --add 4590 adad
Incorrect phone number
$ faceid.py --add 4590 +73431231543543534653
Incorrect phone number
$ faceid.py --add 4590
Incorrect phone number
```
_Комментарий_:

Выдается сообщение об ошибке, если номер телефона указан некорректно. Корректный номер содержит 11 цифр и начинается со знака +.

##### Критерий оценивания AC-014-08
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ faceid.py --find /path/to/video23.avi
168f2e61-089f-88a9-53b2-3b3d0c497704 identified
$ faceid.py --add 5981 +79037518950
Registration request sent by 0x6a8a46c4e005b9e8bea97aa58c5839787b5689e9e8785ea9e38330395582f78f
```
_Комментарий_:

В блокчейн сеть отправляется транзакция с запросом регистрации соответствия аккаунта даже если в контракте регистра уже учтены запросы на регистрацию соответствий других аккаунтов. При обработке запроса, контракт производит событие (`event`) `RegistrationRequest`.

##### Критерий оценивания AC-014-09
```shell
$ cat network.json | python -mjson.tool | grep gasPriceUrl 
    "gasPriceUrl": "https://gasprice.poa.network/",
$ curl https://gasprice.poa.network/
curl: (6) Could not resolve host: gasprice.poa.network
$ faceid.py --add 5981 +79037518950
Registration request sent by 0x6a8a46c4e005b9e8bea97aa58c5839787b5689e9e8785ea9e38330395582f78f
```
_Комментарий_:

В блокчейн сеть отправляется транзакция c запросом регистрации соответствия аккаунта. Транзакция успешно верифицирована и включена в блок. Для проведения транзакции выбрана цена из значения `defaultGasPrice` из файла `network.json`.

##### Критерий оценивания AC-014-10
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0x73aad4ff595a8813cc7d440d244545017c77098528f010a7caaa7d74c382f6c5
```
_Комментарий_:

Если из транзакции c идентификатором `0x73aad4ff595a8813cc7d440d244545017c77098528f010a7caaa7d74c382f6c5` извлечь поле `input` и отправить его в новой транзакции с того же аккаунта снова в поле `input` на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка, поскольку такой запрос регистрации соответствия уже был послан в контракт. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-014-11
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
```
_Комментарий_:

Если из транзакции с идентификатором `0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69` извлечь поле `input`, изменить в нем те байты, которые кодируют номер телефона так, чтобы передаваемый номер телефона содержал количество цифр отличное от 11, либо содержал буквы, и отправить получившийся набор байт в новой транзакции с того же аккаунта снова в поле `input` на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка, поскольку такой номер телефона некорректный. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-014-12
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0x73aad4ff595a8813cc7d440d244545017c77098528f010a7caaa7d74c382f6c5
```
_Комментарий_:

Если из транзакции c идентификатором `0x73aad4ff595a8813cc7d440d244545017c77098528f010a7caaa7d74c382f6c5` извлечь поле `input` и отправить его в новой транзакции с аккаунта, отличающегося от `from` в упомянутой выше транзакции, на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - успешно, поскольку такой изначальный запрос регистрации соответствия еще не был подтвержден. Статус транзакции можно подтвердить для данной транзакции в браузере блоков.

#### US-015 Отправка запроса на удаление соответствия

После идентификации пользователь может отправить запрос на удаление соответствия между телефоном и своим аккаунтом.

##### Использование скрипта
```shell
$ faceid.py --del <pin code>
```

Используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя. В блокчейн сеть отправляется транзакция к контракту регистра соответствий с запросом удаления. В терминал выводится хэш транзакции, в рамках которой в контракт добавлен запрос удаления.  

##### Критерий оценивания AC-015-01
```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0x58aff6987a78c9109ff3b99b0e1cf333faba313bc8002d4b333653be45d7e1d8
```
_Комментарий_:

В блокчейн сеть отправляется транзакция с запросом удаления ранее зарегистрированного соответствия аккаунта, ассоциированного с аккаунтом, указанным в файле `person.json` и номера телефона. При обработке запроса, контракт производить событие (`event`) `UnregistrationRequest`, в с указанием аккаунта, отправившего запрос:

```solidity
event UnregistrationRequest(address indexed sender);
```

Для проведения транзакции выбрана цена из значения `fast`, возвращенного сервисом `https://gasprice.poa.network`.

##### Критерий оценивания AC-015-02
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0x58aff6987a78c9109ff3b99b0e1cf333faba313bc8002d4b333653be45d7e1d8
$ faceid.py --del 4590
Unregistration request already sent
```
_Комментарий_:

Повторный запрос на удаление соответствия аккаунта не отправляется в блокчейн сеть, поскольку данный аккаунт уже посылал запрос на удаление соответствий. Первичный запрос еще не был обработан. В терминал выводится сообщение об ошибке. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-015-03
```shell
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --add 6104 +79220012534
Registration request sent by 0xc95d677eb6f3fcb55e08274ae0eed1970391e637f1062426a3406fd7d4cfcfcb
$ faceid.py --del 6104
Account is not registered yet
```
_Комментарий_:

Запрос на удаление соответствия аккаунта не отправляется в блокчейн сеть, поскольку данный аккаунт не зарегистрирован в регистре соответствий. В терминал выводится сообщение об ошибке. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-015-04
```shell
$ cat person.json
cat: person.json: No such file or directory
$ faceid.py --del 4590
ID is not found
```
_Комментарий_:

Выдается ошибка, если в текущей директории не существует файл `person.json`. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-015-05
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 1234
No funds to send the request
```
_Комментарий_:

Поскольку ситуация, когда неправильный приватный ключ сформирован из-за некорретного PIN-кода, неотличима от ситуации, когда на аккаунте нет средств для оплаты комиссии на обработку транзакции, в терминал выводится сообщение об ошибке. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-015-06
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ faceid.py --del 4590
No contract address
```
_Комментарий_:

Выдается сообщение об ошибке, если в текущей директории нет файла `registrar.json`, содержащего адрес контракта регистра соответствий. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-015-07
```shell
$ cat registrar.json
{"registrar": {"address": "0x340Ec06460d9b2b7D23B40E5bCd0a81A09e06D81", "startBlock": 456123}, "payments": {"address": "0x81A09e06D81797AE2b7D23B40E5bCd0a1da01eb0F951x", "startBlock": 456125}}
$ faceid.py --del 4590
Seems that the contract address is not the registrar contract 
```
_Комментарий_:

Выдается сообщение об ошибке, если в адрес контракта, указанного в файле `registrar.json`, не принадлежит контракту регистра соответствий.

##### Критерий оценивания AC-015-08
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0x58aff6987a78c9109ff3b99b0e1cf333faba313bc8002d4b333653be45d7e1d8
$ faceid.py --find /path/to/video23.avi
168f2e61-089f-88a9-53b2-3b3d0c497704 identified
$ faceid.py --del 5981
Unregistration request sent by 0xda0e2a124e6d37080b539f1bb0dc4c698b8025b62dcc56d75efc1115d87381aa
```
_Комментарий_:

В блокчейн сеть отправляется транзакция с запросом удаления ранее зарегистрированного соответствия аккаунта даже если в контракте регистра уже учтены запросы на удаление соответствий других аккаунтов. При обработке запроса, контракт производить событие (`event`) `UnregistrationRequest`.

##### Критерий оценивания AC-015-09
```shell
$ cat network.json | python -mjson.tool | grep gasPriceUrl 
    "gasPriceUrl": "https://gasprice.poa.network/",
$ curl https://gasprice.poa.network/
curl: (6) Could not resolve host: gasprice.poa.network
$ faceid.py --del 5981
Unregistration request sent by 0xda0e2a124e6d37080b539f1bb0dc4c698b8025b62dcc56d75efc1115d87381aa
```
_Комментарий_:

В блокчейн сеть отправляется транзакция c запросом удаления соответствия аккаунта. Транзакция успешно верифицирована и включена в блок. Для проведения транзакции выбрана цена из значения `defaultGasPrice` из файла `network.json`.

##### Критерий оценивания AC-015-10
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0x58aff6987a78c9109ff3b99b0e1cf333faba313bc8002d4b333653be45d7e1d8
```
_Комментарий_:

Если из транзакции с идентификатором `0x58aff6987a78c9109ff3b99b0e1cf333faba313bc8002d4b333653be45d7e1d8` извлечь поле `input` и отправить его в новой транзакции с того же аккаунта снова в поле `input` на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка, поскольку такой запрос удаления соответствия уже был послан в контракт. Статус можно подтвердить для данной транзакции в браузере блоков.

#### US-016 Отмена запроса на регистрацию или удаление соответствия

После идентификации пользователь может отправить отмену для запроса на добавление или удаление соответствия между телефоном и своим аккаунтом.

##### Использование скрипта
```shell
$ faceid.py --cancel <pin code>
```

Используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя. В блокчейн сеть отправляется транзакция к контракту регистра соответствий на отмену запроса добавления или удаления соответствия. В терминал выводится хэш транзакции, в рамках которой просиходит отмена.  

##### Критерий оценивания AC-016-01
```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ faceid.py --cancel 4590
Registration canceled by 0x99a7e5f28b653d63b5c0bbddebc91678530ee461e4fa21c9ab2f281d28b8da5e
```
_Комментарий_:

В блокчейн сеть отправляется транзакция с отменой запроса регистрации соответствия аккаунта, ассоциированного с аккаунтом, указанным в файле `person.json`. При обработке запроса, контракт производить событие (`event`) `RegistrationСanceled`, в с указанием аккаунта, отправившего запрос:

```solidity
event RegistrationСanceled(address indexed sender);
```

Для проведения транзакции выбрана цена из значения `fast`, возвращенного сервисом `https://gasprice.poa.network`.

##### Критерий оценивания AC-016-02
```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0x20d2ac2a28641786ba03eff53facea687b35e08e680a1b71922c6fc1ed1f2735
$ faceid.py --cancel 4590
Registration canceled by 0x566674f71911cd3b7cbc2fd66353711d31aaa96f269440d186374a017f53f324
```
_Комментарий_:
Если из транзакции с идентификатором `0x566674f71911cd3b7cbc2fd66353711d31aaa96f269440d186374a017f53f324` извлечь поле `input` и отправить его в новой транзакции с того же аккаунта снова в поле `input` на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка, поскольку запрос регистрации соответствия с этого аккаунта уже был отменен. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-016-03
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0x58aff6987a78c9109ff3b99b0e1cf333faba313bc8002d4b333653be45d7e1d8
$ faceid.py --cancel 4590
Unregistration canceled by 0x84a9548edfa9ce5d05bb7c88702873196f7537e060619d4238e7f23ba8dfe3bd
```
_Комментарий_:

В блокчейн сеть отправляется транзакция с отменой запроса удаления ранее зарегистрированного соответствия аккаунта, ассоциированного с аккаунтом, указанным в файле `person.json`. При обработке запроса, контракт производить событие (`event`) `UnregistrationCanceled`, в с указанием аккаунта, отправившего запрос:

```solidity
event UnregistrationCanceled(address indexed sender);
```

##### Критерий оценивания AC-016-04
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0xbf08d8a2d7c7780024ba6e6dbe12d3d5a5a747ea3071fca63d8a2ede50d3472a
$ faceid.py --cancel 4590
Registration canceled by 0x2946d6e84f7bc52619746d71da01ef04a31855a8deb6dbea29310ab3b0f6201e
```
_Комментарий_:
Если из транзакции с идентификатором `0x2946d6e84f7bc52619746d71da01ef04a31855a8deb6dbea29310ab3b0f6201e` извлечь поле `input` и отправить его в новой транзакции с того же аккаунта снова в поле `input` на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка, поскольку запрос удаления соответствия с этого аккаунта уже был отменен. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-016-05
```shell
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ faceid.py --cancel 4590
Registration canceled by 0x99a7e5f28b653d63b5c0bbddebc91678530ee461e4fa21c9ab2f281d28b8da5e
$ faceid.py --add 4590 +79991234567
Registration request sent by 0x4ae610dabaaddd16fe0097641e0e78b5423f891083bb81266b228a49db54e2ff
```
_Комментарий_:

После отмены запроса регистрации соответствия, в блокчейн сеть снова можно отправить запрос на регистрацию соответствия для того же аккаунта.

##### Критерий оценивания AC-016-06
```shell
$ faceid.py --del 4590
Unregistration request sent by 0x58aff6987a78c9109ff3b99b0e1cf333faba313bc8002d4b333653be45d7e1d8
$ faceid.py --cancel 4590
Unregistration canceled by 0x84a9548edfa9ce5d05bb7c88702873196f7537e060619d4238e7f23ba8dfe3bd
$ faceid.py --del 4590
Unregistration request sent by 0x03a8233da62730a9e5ac69d78c3fc3cf02b04ecb995f5a9f9eb3b17c01692824
```
_Комментарий_:

После отмены запроса на удаление соответствия, в блокчейн сеть снова можно отправить отмену запроса удаления ранее зарегистрированного соответствия аккаунта.

##### Критерий оценивания AC-016-07
```shell
$ faceid.py --add 4590 +79991234567
Registration request sent by 0x4ae610dabaaddd16fe0097641e0e78b5423f891083bb81266b228a49db54e2ff
$ faceid.py --cancel 4590
Registration canceled by 0x3d61f45ffa5ac772fc53d36fcc89bacaee425152d65c7fd9a506ba40aa0ed6e1
$ faceid.py --cancel 4590
No requests found
```
_Комментарий_:

Выдается ошибка, если нет активных запросов на регистрацию или удаления соответствия.

##### Критерий оценивания AC-016-08
```shell
$ faceid.py --del 4590
Unregistration request sent by 0x03a8233da62730a9e5ac69d78c3fc3cf02b04ecb995f5a9f9eb3b17c01692824
$ faceid.py --cancel 4590
Unregistration canceled by 0x41c2cd6cce43fddcd3c1489e1b2f40ad13b635bb0fce22f2ea66a97f15b6c84b
$ faceid.py --cancel 4590
No requests found
```
_Комментарий_:

Выдается ошибка, если нет активных запросов на регистрацию или удаления соответствия.

##### Критерий оценивания AC-016-09
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --cancel 4590
Registration canceled by 0x41c2cd6cce43fddcd3c1489e1b2f40ad13b635bb0fce22f2ea66a97f15b6c84b
$ faceid.py --find /path/to/video23.avi
168f2e61-089f-88a9-53b2-3b3d0c497704 identified
$ faceid.py --cancel 5981
No requests found
```
_Комментарий_:

Выдается ошибка, если нет активных запросов на регистрацию или удаления соответствия.

##### Критерий оценивания AC-016-10
```shell
$ cat person.json
cat: person.json: No such file or directory
$ faceid.py --cancel 4590
ID is not found
```
_Комментарий_:

Выдается ошибка, если в текущей директории не существует файл `person.json`. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-016-11
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --cancel 1234
No funds to send the request
```
_Комментарий_:

Поскольку ситуация, когда неправильный приватный ключ сформирован из-за некорретного PIN-кода, неотличима от ситуации, когда на аккаунте нет средств для оплаты комиссии на обработку транзакции, в терминал выводится сообщение об ошибке. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-016-12
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ faceid.py --cancel 4590
No contract address
```
_Комментарий_:

Выдается сообщение об ошибке, если в текущей директории нет файла `registrar.json`, содержащего адрес контракта регистра соответствий. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-016-13
```shell
$ cat registrar.json
{"registrar": {"address": "0x340Ec06460d9b2b7D23B40E5bCd0a81A09e06D81", "startBlock": 456123}, "payments": {"address": "0x81A09e06D81797AE2b7D23B40E5bCd0a1da01eb0F951x", "startBlock": 456125}}
$ faceid.py --cancel 4590
Seems that the contract address is not the registrar contract 
```
_Комментарий_:

Выдается сообщение об ошибке, если в адрес контракта, указанного в файле `registrar.json`, не принадлежит контракту регистра соответствий.

##### Критерий оценивания AC-016-14
```shell
$ cat network.json | python -mjson.tool | grep gasPriceUrl 
    "gasPriceUrl": "https://gasprice.poa.network/",
$ curl https://gasprice.poa.network/
curl: (6) Could not resolve host: gasprice.poa.network
$ faceid.py --cancel 4590
Registration canceled by 0x41c2cd6cce43fddcd3c1489e1b2f40ad13b635bb0fce22f2ea66a97f15b6c84b
```
_Комментарий_:

В блокчейн сеть отправляется транзакция c отменой запросом регистрации или удаления соответствия аккаунта. Транзакция успешно верифицирована и включена в блок. Для проведения транзакции выбрана цена из значения `defaultGasPrice` из файла `network.json`.

#### US-017 Отправка средств 

После идентификации пользователь может отправить часть средств, которые числятся на его балансе другому пользователю системы, указав его номер телефона.

##### Использование скрипта
```shell
$ faceid.py --send <pin code> <phone number> <value>
```

Через RPC узел блокчейн сети происходит обращение к контракту регистрации соответствий на получение аккаунта соответствующего данному номеру телефона. После этого используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя, в блокчейн сеть отправляется транзакция на перевод средств с баланса пользователя на аккаунт пользователя, ассоциированного с номером телефона.

##### Критерий оценивания AC-017-01
```shell
$ cat network.json | python -mjson.tool | grep gasPriceUrl 
    "gasPriceUrl": "https://gasprice.poa.network/",
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --balance 1234
Your balance is 500 finney
$ faceid.py --send 1234 +79873344556 10000000000000000
Payment of 10 finney to +79873344556 scheduled
Transaction Hash: 0x27c9181caeb55d37e1105fa1a8648db7fe50f79064b98e56b8e854e3abb43728
$ faceid.py --balance 1234
Your balance is 489.860605 finney
```

##### Критерий оценивания AC-017-02
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --balance 1234
Your balance is 90 finney
$ faceid.py --send 1234 +79873344556 10000000000000000
No funds to send the payment
$ faceid.py --balance 1234
Your balance is 90 finney
```

Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-017-03
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --send 1234 +79873312356 10000000000000000
No account with the phone number +79873312356
```

Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-017-04
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --send 1114 +79873312356 10000000000000000
No funds to send the payment
```
_Комментарий_:

Поскольку ситуация, когда неправильный приватный ключ сформирован из-за некорретного PIN-кода, неотличима от ситуации, когда на аккаунте нет средств для перевода, в терминал выводится сообщение об ошибке. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-017-05
```shell
$ faceid.py --send 1234 +79122 10000000000000000
Incorrect phone number
$ faceid.py --send 1234 adad 10000000000000000
Incorrect phone number
$ faceid.py --send 1234 +73431231543543534653 10000000000000000
Incorrect phone number
```

Выдается сообщение об ошибке, если номер телефона указан некорректно. Корректный номер содержит 11 цифр и начинается со знака +.

#### US-018 Генерация сертификата на получение средств

После идентификации пользователь может отправить запрос на создание сертификата на получение определенного количества средств. Созданный сертификат впоследствии может быть использован любым пользователем до истечения срока действия. Сертификат имеет следующий формат: первые 32 байта - цифровой идентификатор сертификата, следующие 66 байт - цифровая подпись цифрового идентификатора (`v`, `r`, `s`).

##### Использование скрипта
```shell
$ faceid.py --gift <pin code> <value> <expire date>
```
Используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя, в блокчейн сеть отправляется транзакция к контракту управления сертификатами на создание нового сертификата на указанную сумму в `wei`, действующий до указанной даты в формате `HH:MM DD.MM.YYYY`. В терминал выводится созданный цифровой сертификат.


#### US-019 Использование сертификата на получение средств 

После идентификации пользователь может отправить запрос на получение средств с уже созданного сертификата. Сертификат может быть использован только один раз и только до истечения указанного при создании срока годности.

##### Использование скрипта
```shell
$ faceid.py --receive <pin code> <certificate>
```
Используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя. В блокчейн сеть отправляется транзакция к контракту управления сертификатами на получение средств c сертификата.


#### US-020 Вернуть средства из неиспользованных сертификатов 

После идентификации пользователь может отправить запрос на возврат средств с уже созданного сертификата после истечения срока годности. Возврат может быть осуществлен только один раз и только с аккаунта создателя сертификата. 

##### Использование скрипта
```shell
$ faceid.py --withdraw <pin code>
```

Используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя. В блокчейн сеть отправляется транзакция к контракту управления сертификатами на возврат средств c сертификата.

#### US-021 Получение истории платежей 

После индентификации пользователь может получить список платежей, связанных с аккаунтом данного пользователя.

##### Использование скрипта
```shell
$ faceid.py --ops 1234
```

Используя идентификатор, содержащийся в `person.json`, и PIN-код скрипт генерирует приватный ключ пользователя. В блокчейн сеть отправляется запрос на баланс аккаунта, полученного из приватного ключа.

История платежей отображается с момента первого подтверждения регистрации соответствия аккаунта, для которого отображаются платежи. В истории 

Сумма в каждой строчке, обозначающей платеж, всегда отображается в poa c точностью до 6 знака.

##### Критерий оценивания AC-021-01
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --ops 1234
Operations:
13:01:42 04.03.2019 FROM: +79418552734 2.5 poa
18:31:52 08.03.2019 FROM: +79019594479 0.5 poa
18:32:02 08.03.2019   TO: +79418552734 0.15 poa
18:33:37 08.03.2019 FROM: +79114505724 0.3 poa
18:34:17 08.03.2019   TO: +79286975842 1.3 poa
$ faceid.py --balance 1234
Your balance is 2.349641 poa
```
_Комментарий_:

Поскольку на данном аккаунте был ненулевой баланс до подтверждения, поэтому итоговый баланс аккаунта больше суммы всех входящих платежей за вычетом всех исходящих платежей.

##### Критерий оценивания AC-021-02
```shell
$ cat person.json
{"id": "81e1dbe6-e0e0-4cf6-af4f-ff8341833b55"}
$ faceid.py --ops 6801
No operations found
$ faceid.py --balance 1234
Your balance is 598458 finney
```
_Комментарий_:

Поскольку на данном аккаунте не было операций, то выводится сообщение об ошибке.

##### Критерий оценивания AC-021-03
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --ops 1234
Operations:
13:01:42 04.03.2019 FROM: +79010451275 2.5 poa
18:31:52 08.03.2019 FROM: +79019594479 0.5 poa
18:32:02 08.03.2019   TO: +79010451275 0.15 poa
18:33:37 08.03.2019 FROM: +79114505724 0.3 poa
18:34:17 08.03.2019   TO: +79286975842 1.3 poa
$ kyc.py --list del
0x32276b955E7dCBeA1C97fe8f06053E760E739e8d: +79010451275
$ kyc.py --confirm 0x32276b955E7dCBeA1C97fe8f06053E760E739e8d
Confirmed by 0xbdf07588e6652aaee28b29156c2ae266c9ba46e253ddd99b466cce31f77c51a3
$ faceid.py --ops 1234
Operations:
13:01:42 04.03.2019 FROM: +79010451275 2.5 poa
18:31:52 08.03.2019 FROM: +79019594479 0.5 poa
18:32:02 08.03.2019   TO: +79010451275 0.15 poa
18:33:37 08.03.2019 FROM: +79114505724 0.3 poa
18:34:17 08.03.2019   TO: +79286975842 1.3 poa
```
_Комментарий_:

Несмотря на то, что соответствие между аккаунтом и телефонным номером было удалено, в списке платежей выводится номер телефона, соответствовавший аккаунту в момент проведения конкретных платежей.

##### Критерий оценивания AC-021-04
```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --ops 1234
Operations:
13:01:42 04.03.2019 FROM: +79010451275 2.5 poa
18:31:52 08.03.2019 FROM: +79019594479 0.5 poa
18:32:02 08.03.2019   TO: +79010451275 0.15 poa
18:33:37 08.03.2019 FROM: +79114505724 0.3 poa
18:34:17 08.03.2019   TO: +79286975842 1.3 poa
$ kyc.py --list del
0xEF8eedf35C2D212bf70389ecA193622e833C3652: +79010451275
$ kyc.py --confirm 0xEF8eedf35C2D212bf70389ecA193622e833C3652
Confirmed by 0xbdf07588e6652aaee28b29156c2ae266c9ba46e253ddd99b466cce31f77c51a3
$ cat person.json
{"id": "81e1dbe6-e0e0-4cf6-af4f-ff8341833b55"}
$ faceid.py --add 6801 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ kyc.py --confirm 0xEF8eedf35C2D212bf70389ecA193622e833C3652
Confirmed by 0xbdf07588e6652aaee28b29156c2ae266c9ba46e253ddd99b466cce31f77c51a3
$ faceid.py --send 6801 +79873344556 15026871000000000000
Payment of 10 finney to +79873344556 scheduled
Transaction Hash: 0x27c9181caeb55d37e1105fa1a8648db7fe50f79064b98e56b8e854e3abb43728
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --ops 1234
Operations:
13:01:42 04.03.2019 FROM: +79010451275 2.5 poa
18:31:52 08.03.2019 FROM: +79019594479 0.5 poa
18:32:02 08.03.2019   TO: +79010451275 0.15 poa
18:33:37 08.03.2019 FROM: +79114505724 0.3 poa
18:34:17 08.03.2019   TO: +79286975842 1.3 poa
18:39:34 08.03.2019 FROM: +79991234567 1.502687 poa
```
_Комментарий_:

Несмотря на то, что соответствие между аккаунтом и телефонным номером было изменено, в списке платежей выводятся оба номера телефона, соответствовавшие аккаунту в момент проведения конкретных платежей.

##### Критерий оценивания AC-021-05
```shell
$ cat person.json
{"id": "81e1dbe6-e0e0-4cf6-af4f-ff8341833b55"}
$ faceid.py --ops 1010
No operations found
```
_Комментарий_:

Поскольку ситуация, когда неправильный приватный ключ сформирован из-за некорретного PIN-кода, неотличима от ситуации, когда нет операций ассоциированных с аккаунтом, в терминал выводится сообщение об ошибке.

##### Критерий оценивания AC-021-06
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ faceid.py --ops 6801
No contract address
```
_Комментарий_:

Выдается сообщение об ошибке, если в текущей директории нет файла registrar.json, содержащего адрес контракта регистра соответствий. 

##### Критерий оценивания AC-021-07
```shell
$ cat registrar.json
{"registrar": {"address": "0x340Ec06460d9b2b7D23B40E5bCd0a81A09e06D81", "startBlock": 456123}, "payments": {"address": "0x81A09e06D81797AE2b7D23B40E5bCd0a1da01eb0F951x", "startBlock": 456125}}
$ faceid.py --ops 6801
Seems that the contract address is not the registrar contract 
```
_Комментарий_:

Выдается сообщение об ошибке, если в адрес контракта, указанного в файле registrar.json, не принадлежит контракту регистра соответствий. 

#### US-022 Получение истории платежей, включая использование сертификатов

##### Использование скрипта
```shell
$ faceid.py --opsall <pin code>
```

### Администрирование сервиса KYC

Управление сервисом соответствий блокчейн аккаунтов и номеров телефонов происходить с использованием отдельной компоненты. Эта компонента позволяет администратору сервиса подтерждать запросы на регистрацию соответствий и запросы на удаление соответствий. 

**Синтаксис**
```shell
kyc.py <command> [options]
```

В зависимости от команды, через RPC узел блокчейн сети будет отправляться либо запрос на информацию, либо транзакция к контракту регистра соответствий. 

#### US-023 Получение всех запросов на регистрацию соответствий

Любой пользователь сервиса,  может получить список всех запросов на регистрацию соответствий. 

##### Использование скрипта
```shell
$ kyc.py --list add
```

Через RPC узел блокчейн сети отправляется запрос к контракту, адрес которого указан в поле `registrar` файла `registrar.json`, на получение всех неотменненных запросов на регистрацию соответствий. Запросы выводятся в формате `отправитель запроса: номер телефона`

##### Критерий оценивания AC-023-01

```shell
$ setup.py --deploy
KYC Registrar: 0x00360d2b7D240Ec0643B6D819ba81A09e40E5bCd
Payment Handler: 0x95426f2bC716022fCF1dEf006dbC4bB81f5B5164
$ cat registrar.json
{"registrar": {"address": "0x00360d2b7D240Ec0643B6D819ba81A09e40E5bCd", "startBlock": 123456}, "payments": {"address": "0x95426f2bC716022fCF1dEhttps://gasprice.poa.network/f006dbC4bB81f5B5164", "startBlock": 123457}}
$ kyc.py --list add
No KYC registration requests found
```
_Комментарий_:

Поскольку в контракте, адрес которого указан в файле `registrar.json`, не было зарегистрировано ни одного запроса регистрации соответствия аккаунта, то выдается соответствующее сообщение. Транзакции в сеть не отправляются.

##### Критерий оценивания AC-023-02

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list add
No KYC registration requests found
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --add 6104 +79220012534
Registration request sent by 0xc95d677eb6f3fcb55e08274ae0eed1970391e637f1062426a3406fd7d4cfcfcb
$ rm person.json
$ kyc.py --list add
0x5bAD5c60781111094C247F81792eDDE9bb38818A: +79220012534
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
```
_Комментарий_:

Все два запроса на регистрацию соответствия, отправленные в контракт, адрес которого указан в файле `registrar.json`, отображены в выводе команды `kyc.py --list`. Сортировка вывода происходит по номеру телефона. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-023-03

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list add
No KYC registration requests found
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --add 6104 +79991234567
Registration request sent by 0xc95d677eb6f3fcb55e08274ae0eed1970391e637f1062426a3406fd7d4cfcfcb
$ rm person.json
$ kyc.py --list add
0x5bAD5c60781111094C247F81792eDDE9bb38818A: +79991234567
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
```
_Комментарий_:

Два запроса на регистрацию соответствия, отправленные в контракт, адрес которого указан в файле `registrar.json`, приняты контрактом даже если они - для регистрации одного и того же номера телефона. Оба запроса отображены в выводе команды `kyc.py --list`. Сортировка вывода происходит сначала по номеру телефона, затем по адресу аккаунта. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-023-04

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list add
No KYC registration requests found
$ cat person.json
{"id": "5069b18c-9f6d-42f9-aa5f-a5f6b924d87e"}
$ faceid.py --add 1096 +79125812224
Registration request sent by 0x01bef0afddd3ebc79e80c0385bf5e0bfea871b97d937c74462a3221094b44c1c
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --add 6104 +79220012534
Registration request sent by 0xc95d677eb6f3fcb55e08274ae0eed1970391e637f1062426a3406fd7d4cfcfcb
$ cat person.json
{"id": "5069b18c-9f6d-42f9-aa5f-a5f6b924d87e"}
$ faceid.py --cancel 1096
Registration canceled by 0x99a7e5f28b653d63b5c0bbddebc91678530ee461e4fa21c9ab2f281d28b8da5e
$ rm person.json
$ kyc.py --list add
0x5bAD5c60781111094C247F81792eDDE9bb38818A: +79220012534
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
```
_Комментарий_:

Только два запроса на регистрацию соответствия, отправленные в контракт, адрес которого указан в файле `registrar.json`, отображены в выводе команды `kyc.py --list`. Отмененный запрос не отображается. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-023-05

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list add
No KYC registration requests found
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --add 6104 +79220012534
Registration request sent by 0xc95d677eb6f3fcb55e08274ae0eed1970391e637f1062426a3406fd7d4cfcfcb
$ faceid.py --cancel 6104
Registration canceled by 0x99a7e5f28b653d63b5c0bbddebc91678530ee461e4fa21c9ab2f281d28b8da5e
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --cancel 4590
Registration canceled by 0xc90366c708b1c1e8462da76682338d5262a785d592918ed915e1292ac0d6178a
$ rm person.json
$ kyc.py --list add
No KYC registration requests found
```
_Комментарий_:

Поскольку все запросы на регистрацию соответствий, оптравленные в контракт, адрес которого указан в файле `registrar.json`, были отменены, то в выводе команды `kyc.py --list` выдается соответствующее сообщение. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-023-06

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list add
No KYC registration requests found
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xa7f3239715ff731a3d6fc477b18e35b9b0a9e1ede84bca5e91517e8e5bf1cc69
$ faceid.py --find /path/to/video23.avi
168f2e61-089f-88a9-53b2-3b3d0c497704 identified
$ faceid.py --del 5981
Unregistration request sent by 0xda0e2a124e6d37080b539f1bb0dc4c698b8025b62dcc56d75efc1115d87381aa
$ rm person.json
$ kyc.py --list add
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
```
_Комментарий_:

Только запросы на регистрацию соответствий, оптравленные в контракт, адрес которого указан в файле `registrar.json`, отображаются в выводе команды `kyc.py --list`. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-023-07
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ kyc.py --list add
No contract address
```
_Комментарий_:

Выдается сообщение об ошибке, если в текущей директории нет файла `registrar.json`, содержащего адрес контракта регистра соответствий. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-023-08
```shell
$ cat registrar.json
{"registrar": {"address": "0x340Ec06460d9b2b7D23B40E5bCd0a81A09e06D81", "startBlock": 456123}, "payments": {"address": "0x81A09e06D81797AE2b7D23B40E5bCd0a1da01eb0F951x", "startBlock": 456125}}
$ kyc.py --list add
Seems that the contract address is not the registrar contract
```
_Комментарий_:

Выдается сообщение об ошибке, если в адрес контракта, указанного в файле `registrar.json`, не принадлежит контракту регистра соответствий.

#### US-024 Получение всех запросов на удаление соответствий

Любой пользователь сервиса,  может получить список всех запросов на удаление соответствий. 

##### Использование скрипта
```shell
$ kyc.py --list del
```

Через RPC узел блокчейн сети отправляется запрос к контракту, адрес которого указан в поле `registrar` файла `registrar.json`, на получение всех неотменненных запросов на удаление соответствий. Запросы выводятся в формате `отправитель запроса: номер телефона`

##### Критерий оценивания AC-024-01

```shell
$ setup.py --deploy
KYC Registrar: 0x00360d2b7D240Ec0643B6D819ba81A09e40E5bCd
Payment Handler: 0x95426f2bC716022fCF1dEf006dbC4bB81f5B5164
$ cat registrar.json
{"registrar": {"address": "0x00360d2b7D240Ec0643B6D819ba81A09e40E5bCd", "startBlock": 123456}, "payments": {"address": "0x95426f2bC716022fCF1dEhttps://gasprice.poa.network/f006dbC4bB81f5B5164", "startBlock": 123457}}
$ kyc.py --list add
No KYC unregistration requests found
```
_Комментарий_:

Поскольку в контракте, адрес которого указан в файле `registrar.json`, не было зарегистрировано ни одного запроса удаления соответствия аккаунта, то выдается соответствующее сообщение. Транзакции в сеть не отправляются.

##### Критерий оценивания AC-024-02

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list del
No KYC unregistration requests found
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0x64e604787cbf194841e7b68d7cd28786f6c9a0a3ab9f8b0a0e87cb4387ab0107
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --del 6104
Unregistration request sent by 0xac09810740600c31fa69f9db79ed6fc3e3281f758a950fe1fb254a3a3ae571b6
$ rm person.json
$ kyc.py --list del
0x5bAD5c60781111094C247F81792eDDE9bb38818A: +79220012534
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
```
_Комментарий_:

Все два запроса на удаление соответствия, отправленные в контракт, адрес которого указан в файле `registrar.json`, отображены в выводе команды `kyc.py --list`. Сортировка вывода происходит по номеру телефона. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-024-03

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list del
No KYC unregistration requests found
$ cat person.json
{"id": "5069b18c-9f6d-42f9-aa5f-a5f6b924d87e"}
$ faceid.py --del 1096
Unregistration request sent by 0x631897788617bc63fb0292c44f57a6c3824e4264bc88fb4e3c08b910f3f417fc
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0x7dbef654fd5c6145f82b72cd5dbbfc6d48fd276b8a7a4371a61d55985b9d6d8b
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --del 6104
Unregistration request sent by 0xf65e3ff0de05ca77aa8c820bd528facc139ee4b0986f7c350f3198928bd2c72b
$ cat person.json
{"id": "5069b18c-9f6d-42f9-aa5f-a5f6b924d87e"}
$ faceid.py --cancel 1096
Unregistration canceled by 0x24036ccf201a67256250eabe66d3f9fd72f9c4d022f225a8ee964be060dcb993
$ rm person.json
$ kyc.py --list del
0x5bAD5c60781111094C247F81792eDDE9bb38818A: +79220012534
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
```
_Комментарий_:

Только два запроса на удаление соответствия, отправленные в контракт, адрес которого указан в файле `registrar.json`, отображены в выводе команды `kyc.py --list`. Отмененный запрос не отображается. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-024-04

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list del
No KYC unregistration requests found
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --del 4590
Unregistration request sent by 0x535306ee4b42c92aecd0e71fca98572064f049c2babb2769faa3bbd87d67ec2d
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --del 6104
Unregistration request sent by 0x425a3d65e6c6cbbf01507814af1ac7512f93cceb8411381e1d5fb7adbfd44881
$ faceid.py --cancel 6104
Unregistration canceled by 0xd772c1d26a64e4114af99655ec353dc3dba1b12ba483c0fc852e01d0432d3aa1
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --cancel 4590
Unregistration canceled by 0xe7fcf89c34605f23590ff58513f1080dc375dd06cc5e256320151057827a258a
$ rm person.json
$ kyc.py --list del
No KYC unregistration requests found
```
_Комментарий_:

Поскольку все запросы на удаление соответствий, оптравленные в контракт, адрес которого указан в файле `registrar.json`, были отменены, то в выводе команды `kyc.py --list` выдается соответствующее сообщение. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-024-05

```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --list del
No KYC unregistration requests found
$ faceid.py --find /path/to/video23.avi
168f2e61-089f-88a9-53b2-3b3d0c497704 identified
$ faceid.py --del 5981
Unregistration request sent by 0xa413d075ec804ca282f1637fedbe82ecda1992097d14e4d900d254e0f5fe523d
$ faceid.py --find /path/to/video24.avi
37da04e7-f471-49c7-a54c-a08f05950fc5 identified
$ faceid.py --add 4590 +79991234567
Registration request sent by 0x2f5ccb30fa919306cd2899a81c7670a9b1be09e8c15a0b78b0fbbc777d15e97b
$ rm person.json
$ kyc.py --list del
0x7F3faAe3f2238439d6ea5A320caB969aC62b68e3: +79870194581
```
_Комментарий_:

Только запросы на удаление соответствий, оптравленные в контракт, адрес которого указан в файле `registrar.json`, отображаются в выводе команды `kyc.py --list`. Транзакции этой командой в сеть не отправляются.

##### Критерий оценивания AC-024-06
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ kyc.py --list del
No contract address
```
_Комментарий_:

Выдается сообщение об ошибке, если в текущей директории нет файла `registrar.json`, содержащего адрес контракта регистра соответствий. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-024-07
```shell
$ cat registrar.json
{"registrar": {"address": "0x340Ec06460d9b2b7D23B40E5bCd0a81A09e06D81", "startBlock": 456123}, "payments": {"address": "0x81A09e06D81797AE2b7D23B40E5bCd0a1da01eb0F951x", "startBlock": 456125}}
$ kyc.py --list del
Seems that the contract address is not the registrar contract
```
_Комментарий_:

Выдается сообщение об ошибке, если в адрес контракта, указанного в файле `registrar.json`, не принадлежит контракту регистра соответствий.

#### US-025 Подтверждение запросов на регистрацию или удаление соответствий

Только администратор KYC сервиса имеет полномочия подтверждать запросы на регистрацию или удаление соответствий аккаунтов пользователей их телефонным номерам. 

##### Использование скрипта
```shell
$ kyc.py --confirm <address>
```

В блокчейн сеть отправляется транзакция к контракту регистра соответствий. Контракт проверяет обладает ли отправитель транзакции полномочиями по подтверждению запросов, после чего происходит изменение статуса запроса:
  * если запрос был на регистрацию соответствия между аккаунтом и телефонным номером, то это соответствие становится доступным для других пользователей;
  * если запрос был на удаление соответствия, то соответствие перестает существовать - по номеру телефона, который указывался в соответствии, больше нельзя будет получить адрес аккаунта.

##### Критерий оценивания AC-025-01

```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
$ setup.py --owner registrar
Admin account: 0x9cce34F7aB185c7ABA1b7C8140d620B4BDA941d6
$ kyc.py --list add
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ kyc.py --confirm 0xFCE1151f31065913F124917E0F2Ba5a6e29D6426
Confirmed by 0x9960ed3041b9945289da338fa273462c820f58427408d57789c0e1400ad5c9bb
$ kyc.py --list add
No KYC registration requests found
```

Поскольку аккаунт, чей приватный ключ указан в `network.json`, обладает полномочиями на подтверждение запросов на регистрацию соответствий, посланная транзакция включается в блок со статусом успешного исполнения. Статус можно подтвердить для данной транзакции в браузере блоков.

При подтверждении контракт производит событие (`event`) `RegistrationConfirmed`, в с указанием аккаунта, отправившего запрос:

```solidity
event RegistrationConfirmed(address indexed sender);
```

Для проведения транзакции выбрана цена из значения `fast`, возвращенного сервисом `https://gasprice.poa.network`.

##### Критерий оценивания AC-025-02

```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "6fadbaf86d2aa9c9e34a85df385a2c9afa9509e09756634e72bbcf94a5ceb213",
$ setup.py --owner registrar
Admin account: 0x5e4d710a4995bFA3F6560effcad36C10ebac998C
$ kyc.py --list add
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ kyc.py --confirm 0xFCE1151f31065913F124917E0F2Ba5a6e29D6426
Failed but included in 0x9960ed3041b9945289da338fa273462c820f58427408d57789c0e1400ad5c9bb
$ kyc.py --list add
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
```

Поскольку аккаунт, чей приватный ключ указан в `network.json`, не обладает полномочиями на подтверждение запросов на регистрацию соответствий, посланная транзакция включается в блок, но статус ее исполнения - ошибка. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-025-03

```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
$ setup.py --owner registrar
Admin account: 0x9cce34F7aB185c7ABA1b7C8140d620B4BDA941d6
$ kyc.py --list del
0x32276b955E7dCBeA1C97fe8f06053E760E739e8d: +79010451275
$ kyc.py --confirm 0x32276b955E7dCBeA1C97fe8f06053E760E739e8d
Confirmed by 0xbdf07588e6652aaee28b29156c2ae266c9ba46e253ddd99b466cce31f77c51a3
$ kyc.py --list del
No KYC unregistration requests found
```

Поскольку аккаунт, чей приватный ключ указан в `network.json`, обладает полномочиями на подтверждение запросов на удаление соответствий, посланная транзакция включается в блок со статусом успешного исполнения. Статус можно подтвердить для данной транзакции в браузере блоков.

При подтверждении контракт производит событие (`event`) `UnregistrationConfirmed`, в с указанием аккаунта, отправившего запрос:

```solidity
event UnregistrationConfirmed(address indexed sender);
```

Для проведения транзакции выбрана цена из значения `fast`, возвращенного сервисом `https://gasprice.poa.network`.

##### Критерий оценивания AC-025-04

```shell
$ cat network.json | python -mjson.tool | grep privKey 
    "privKey": "6fadbaf86d2aa9c9e34a85df385a2c9afa9509e09756634e72bbcf94a5ceb213",
$ setup.py --owner registrar
Admin account: 0x5e4d710a4995bFA3F6560effcad36C10ebac998C
$ kyc.py --list del
0x32276b955E7dCBeA1C97fe8f06053E760E739e8d: +79010451275
$ kyc.py --confirm 0x32276b955E7dCBeA1C97fe8f06053E760E739e8d
Failed but included in 0x360f73c63c063fae5d1e9ead454a4836ec470b54de0960f05909b7f8c7c140ba
$ kyc.py --list del
0x32276b955E7dCBeA1C97fe8f06053E760E739e8d: +79010451275
```

Поскольку аккаунт, чей приватный ключ указан в `network.json`, не обладает полномочиями на подтверждение запросов на удаление соответствий, посланная транзакция включается в блок, но статус ее исполнения - ошибка. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-025-05

```shell
$ kyc.py --list add
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ faceid.py --cancel 6104
Registration canceled by 0x26a975632f70533c9512e57b565b8ce8e2befee6b08dfbc27c4a897a20e2c1d6
$ kyc.py --list add
No KYC registration requests found
$ kyc.py --confirm 0xFCE1151f31065913F124917E0F2Ba5a6e29D6426
Failed but included in 0xd534ca6cd7b201fa32702a1b5b6a38881f8a63e70f9d3e1a8a953d61c6524405
```

Аккаунт, чей приватный ключ указан в `network.json`, обладает полномочиями на подтверждение запросов на регистрацию соответствий. А поскольку запрос на регистрацию соответствия был отменен, посланная транзакция на подтерждение регистрации включается в блок, но статус ее исполнения - ошибка. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-025-06

```shell
$ kyc.py --list add
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ kyc.py --confirm 0xFCE1151f31065913F124917E0F2Ba5a6e29D6426
Confirmed by 0x2b2a51e6e75ece6beb4c5ed9d51d381a6766e4929f34c8c545b0c0f22a890e3d
$ faceid.py --cancel 6104
No requests found
```

Транзакция, посланная в блокчейн сеть, на подвтерждение запроса регистрации соответствия включается в блок со статусом успешного исполнения. Статус можно подтвердить для данной транзакции в браузере блоков. Поскольку успешного подтверждения запрос теряет актуальность, то его нельзя в дальнейшем отменить.

##### Критерий оценивания AC-025-07

```shell
$ kyc.py --list del
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ faceid.py --cancel 6104
Unregistration canceled by 0xcfe93e00cbaaf37bad5f0b2ff3ab98072b4f3a2656e148b3bcccb553f2fa678f
$ kyc.py --list del
No KYC unregistration requests found
$ kyc.py --confirm 0xFCE1151f31065913F124917E0F2Ba5a6e29D6426
Failed but included in 0x890f693d9ea1b595bb4a33efee4a21d60a63ffd2ec40c37883b92f82fc5da52b
```

Аккаунт, чей приватный ключ указан в `network.json`, обладает полномочиями на подтверждение запросов на удаление соответствий. А поскольку запрос на удаление соответствия был отменен, посланная транзакция на подтерждение удаления включается в блок, но статус ее исполнения - ошибка. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-025-08

```shell
$ kyc.py --list del
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ kyc.py --confirm 0xFCE1151f31065913F124917E0F2Ba5a6e29D6426
Confirmed by 0x7b0ac78d4efde931c083b037c1c7f91b4cc8f27a159c1264ae53aa473f3e4e6a
$ faceid.py --cancel 6104
No requests found
```

Транзакция, посланная в блокчейн сеть, на подвтерждение запроса удаления соответствия включается в блок со статусом успешного исполнения. Статус можно подтвердить для данной транзакции в браузере блоков. Поскольку успешного подтверждения запрос теряет актуальность, то его нельзя в дальнейшем отменить.

##### Критерий оценивания AC-025-09

```shell
$ kyc.py --list add
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ kyc.py --confirm 0xFCE1151f31065913F124917E0F2Ba5a6e29D6426
Confirmed by 0x2b2a51e6e75ece6beb4c5ed9d51d381a6766e4929f34c8c545b0c0f22a890e3d
$ faceid.py --del 6104
Unregistration request sent by 0x5a10742dc65b7a28255fe7b4d2b9f290786892e1e437654e2ccb53bed1bfe01a
```

Транзакция, посланная в блокчейн сеть, на подвтерждение запроса регистрации соответствия включается в блок со статусом успешного исполнения. Статус можно подтвердить для данной транзакции в браузере блоков. Теперь для установленного соответствия есть возможность отправить запрос на его удаление.

##### Критерий оценивания AC-025-10

```shell
$ kyc.py --list del
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ kyc.py --confirm 0xFCE1151f31065913F124917E0F2Ba5a6e29D6426
Confirmed by 0xe3cb0ca89f217511efd4af6caea80048f9921bac3b9063844e65469cf515f138
$ faceid.py --add 6104 +79991234567
Registration request sent by 0x41c2cc0c9e11501a3eec0956812949b1b9b2d14d9dc7118df2ef1aac71f18767
```

Транзакция, посланная в блокчейн сеть, на подвтерждение запроса удаления соответствия включается в блок со статусом успешного исполнения. Статус можно подтвердить для данной транзакции в браузере блоков. Поскольку у данного аккаунта больше нет актуального соответствия, то есть возможность отправить запрос на создание нового соответствия.

##### Критерий оценивания AC-025-11

```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x06a79e67d636d828aa58884bc7fed897698bb40922db4eadf708235cd9c2de2c
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --add 6104 +79991234567
Such phone number already registered
```

При запросе на регистрацию соответствия выводится сообщение об ошибке, поскольку такой номер телефона уже зарегистрирован в системе. Транзакция в блокчейн не отправляется.

##### Критерий оценивания AC-025-12

```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x06a79e67d636d828aa58884bc7fed897698bb40922db4eadf708235cd9c2de2c
```

Если из транзакции c идентификатором `0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d` извлечь поле `input` и отправить его в поле `input` новой транзакции с аккаунта, который отличется от аккаунта, отправившего эту транзакцию, на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка, поскольку запрашиваемый в данных телефонный номер уже зарегистрирован в системе. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-025-13

```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d
$ cat person.json
{"id": "229b3307-fe57-4ddc-b7e7-ac9f1de7abda"}
$ faceid.py --add 3928 +79991234567
Registration request sent by 0x0330c0d84464f890f3c81afbba7a3a05e0e864ec2e31676dedcb075b2bf855a0
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x06a79e67d636d828aa58884bc7fed897698bb40922db4eadf708235cd9c2de2c
```

Если из транзакции, которая была отправлена в результате команды `kyc.py --confirm`, извлечь поле `input` и отправить его в новой транзакции снова в поле `input` на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка по причине того, что такое соответствие уже подтверждено. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-025-14

```shell
$ kyc.py --list add
0xFf8E5C14d240d76EAe66aEF1A3a99895e08a0c3F: +79271173070
0xa898240Ba2D5C0C2537BC187CaC5B70843EAC8dD: +79397411449
0x60861DE06626f60d89f5795AD950B502CE00A8B0: +79017422129
$ kyc.py --list del
0x5bAD5c60781111094C247F81792eDDE9bb38818A: +79220012534
0xFCE1151f31065913F124917E0F2Ba5a6e29D6426: +79991234567
$ kyc.py --confirm 0x60861DE06626f60d89f5795AD950B502CE00A8B1
Failed but included in 0x18e28784ed3043bccd713a5f99352b74c3ebc4ca469216a686040f025571a184
```

Поскольку запрос, который пытается подтвердиться, не существует, то посланная транзакция включается в блок, но статус ее исполнения - ошибка. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-025-15
```shell
$ cat person.json
{"id": "da04e377-47f1-c749-54ca-0fc5a08f0595"}
$ faceid.py --add 6104 +79220012534
Registration request sent by 0xa65d03add95baf22e482ebcd3423aa9bf9d8b0ec3fca2831960080b84536d360
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x05dee4192aaad4acb149f9615e8a72a761fc8cdb1d8b4e9c00fe66665f5a8184
$ faceid.py --del 6104
Unregistration request sent by 0x1b6edb65b6c2611a7285cc668f4110f574a7bc3b0d28690b40a16f141eada39a
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x1c6c2dd4b412e3c82ad1f10cef9a1a4112bc1a128dc4d12242d781aa03ccbf2c
```
_Комментарий_:

Если из транзакции с идентификатором `0x1b6edb65b6c2611a7285cc668f4110f574a7bc3b0d28690b40a16f141eada39a`, извлечь поле `input` и отправить его в новой транзакции снова в поле `input` на адрес контракта регистра соответствий, то эта транзакция будет включена в блок, но статус ее исполнения будет - ошибка поскольку данный аккаунт больше не зарегистрирован в регистре соответствий. Статус можно подтвердить для данной транзакции в браузере блоков.

##### Критерий оценивания AC-025-16
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ kyc.py --confirm 0x60861DE06626f60d89f5795AD950B502CE00A8B0
No contract address
```
_Комментарий_:

Выдается сообщение об ошибке, если в текущей директории нет файла `registrar.json`, содержащего адрес контракта регистра соответствий. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-025-17
```shell
$ cat registrar.json
{"registrar": {"address": "0x340Ec06460d9b2b7D23B40E5bCd0a81A09e06D81", "startBlock": 456123}, "payments": {"address": "0x81A09e06D81797AE2b7D23B40E5bCd0a1da01eb0F951x", "startBlock": 456125}}
$ kyc.py --confirm 0x60861DE06626f60d89f5795AD950B502CE00A8B0
Seems that the contract address is not the registrar contract
```
_Комментарий_:

Выдается сообщение об ошибке, если в адрес контракта, указанного в файле `registrar.json`, не принадлежит контракту регистра соответствий.

##### Критерий оценивания AC-025-18
```shell
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --confirm 0x60861DE06626f60d89f5795AD950B502CE00A8B0
No admin account found
```

Выдается сообщение об ошибке, если в `network.json` нет приватного ключа аккаунта, от имени которого выполнялось бы подтверждение.

#### US-026 Получение аккаунта по номеру телефона

Любой пользователь по номеру телефона может получить аккаунт соответствующий номеру телефона, если такое соответствие было зарегистрировано.

##### Использование скрипта
```shell
$ kyc.py --get <phone number>
```

Через RPC узел блокчейн сети отправляется запрос к контракту, адрес которого указан в поле `registrar` файла `registrar.json`, на получение соответствия. Если соответствие не зарегистрировано, контракт возвращает `0x000000000000000000000000000000000000000`.

##### Критерий оценивания AC-026-01

```shell
$ setup.py --deploy
KYC Registrar: 0x23B40E5bCd06D819ba81A09e0340Ec06460d2b7D
Payment Handler: 0xE797A1da01eb0F951E0E400f9343De9d17A06bac
$ kyc.py --get +79017422129
Correspondence not found
```

Поскольку в контракте не было зарегистированных соответствий, то соответствующее сообщение выводится на экран.

##### Критерий оценивания AC-026-02

```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x06a79e67d636d828aa58884bc7fed897698bb40922db4eadf708235cd9c2de2c
$ cat person.json
{"id": "229b3307-fe57-4ddc-b7e7-ac9f1de7abda"}
$ faceid.py --add 3928 +79418552734
Registration request sent by 0x0330c0d84464f890f3c81afbba7a3a05e0e864ec2e31676dedcb075b2bf855a0
$ kyc.py --confirm 0xdCaBFD5c76D3717567568710a735717bf0C792De
Confirmed by 0x840881693295f1213bc621234bc18aa1727c90c9e1416799df22e18f9c7c029b
$ rm person.rm
$ cat network.json
{"rpcUrl": "https://sokol.poa.network", "gasPriceUrl": "https://gasprice.poa.network/", "defaultGasPrice": 2000000000}
$ kyc.py --get +79991234567
Registered correspondence: 0x5bAD5c60781111094C247F81792eDDE9bb38818A
```

Для одно из зарегистированных соответствий выводится аккаунт, с которым связан указанных номер телефона. Транзакция в сеть не отправляется. 

##### Критерий оценивания AC-026-03

```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x06a79e67d636d828aa58884bc7fed897698bb40922db4eadf708235cd9c2de2c
$ kyc.py --get +79991234567
Registered correspondence: 0x5bAD5c60781111094C247F81792eDDE9bb38818A
$ faceid.py --del 4590
Unregistration request sent by 0xc7d00ca82740de2eef417cfa47c2970dbdec49b2a6d15c64e85f83cf97939ca5
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x0697183ae8eedd43b56f90cfa450ea6e3ac27fb69f1056ee33ccc5a9587bcd2a
$ kyc.py --get +79991234567
Correspondence not found
```

В первом случае, соответствие зарегистрировано и поэтому вызов команды позволяет получить аккаунт по номеру телефона. К моменты вызова команды второй раз, соответствие удалено, поэтому выводится сообщение об ошибке.

##### Критерий оценивания AC-026-04

```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d
$ kyc.py --get +79991234567
Correspondence not found
```

Хотя регистрация соответствия только была запрошена, оно не было подтверждено, поэтому выводится сообщение об ошибке.

##### Критерий оценивания AC-026-05

```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x06a79e67d636d828aa58884bc7fed897698bb40922db4eadf708235cd9c2de2c
$ faceid.py --del 4590
Unregistration request sent by 0xc7d00ca82740de2eef417cfa47c2970dbdec49b2a6d15c64e85f83cf97939ca5
$ kyc.py --get +79991234567
Registered correspondence: 0x5bAD5c60781111094C247F81792eDDE9bb38818A
```

Поскольку удаление соответствия не было было подтверждено, поэтому выводится информация об аккаунте.

##### Критерий оценивания AC-026-06

```shell
$ cat person.json
{"id": "37da04e7-f471-49c7-a54c-a08f05950fc5"}
$ faceid.py --add 4590 +79991234567
Registration request sent by 0xb004fbd84afb38927636fa378c0a62a86a02b00862b6ff80fef4d6e948c0571d
$ cat person.json
{"id": "229b3307-fe57-4ddc-b7e7-ac9f1de7abda"}
$ faceid.py --add 3928 +79991234567
Registration request sent by 0x0330c0d84464f890f3c81afbba7a3a05e0e864ec2e31676dedcb075b2bf855a0
$ kyc.py --confirm 0x5bAD5c60781111094C247F81792eDDE9bb38818A
Confirmed by 0x06a79e67d636d828aa58884bc7fed897698bb40922db4eadf708235cd9c2de2c
$ kyc.py --get +79991234567
Registered correspondence: 0x5bAD5c60781111094C247F81792eDDE9bb38818A
```

Регистрация соответствия первого аккаунта была подтверждена, регистрация второго аккаунта не была подтверждена, поэтому выводится информация об аккаунте, отправившем первый запрос на регистрацию.

##### Критерий оценивания AC-026-07
```shell
$ cat registrar.json
cat: registrar.json: No such file or directory
$ kyc.py --get +79991234567
No contract address
```
_Комментарий_:

Выдается сообщение об ошибке, если в текущей директории нет файла `registrar.json`, содержащего адрес контракта регистра соответствий. Транзакция в блокчейн сеть не отправляется.

##### Критерий оценивания AC-026-08
```shell
$ cat registrar.json
{"registrar": {"address": "0x340Ec06460d9b2b7D23B40E5bCd0a81A09e06D81", "startBlock": 456123}, "payments": {"address": "0x81A09e06D81797AE2b7D23B40E5bCd0a1da01eb0F951x", "startBlock": 456125}}
$ kyc.py --get +79991234567
Seems that the contract address is not the registrar contract
```
_Комментарий_:

Выдается сообщение об ошибке, если в адрес контракта, указанного в файле `registrar.json`, не принадлежит контракту регистра соответствий.

